<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School of Purpose - Ministry Education Management Platform</title>
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6B4423;        /* Dark Brown */
            --secondary: #8B6F47;      /* Medium Brown */
            --accent: #A0826D;         /* Light Brown */
            --success: #6B4423;
            --warning: #A0826D;
            --danger: #4A4A4A;
            --light: #F5F5F5;          /* Off-white */
            --lighter: #FAFAFA;        /* Almost white */
            --dark: #2C2C2C;           /* Almost black */
            --grey: #E0E0E0;           /* Light grey */
            --grey-dark: #757575;      /* Dark grey */
            --white: #FFFFFF;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--lighter);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            color: var(--dark);
        }

        /* Landing Page Styles */
        .landing-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
            background: var(--white);
            color: var(--dark);
        }

        .landing-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 10px;
        }

        .landing-logo img {
            width: 150px;
            height: 150px;
            object-fit: contain;
            margin-bottom: 15px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        .landing-logo-text {
            font-size: 56px;
            font-weight: 300;
            color: var(--primary);
            letter-spacing: -1px;
        }

        .landing-tagline {
            font-size: 18px;
            margin-bottom: 50px;
            color: var(--grey-dark);
            font-weight: 400;
        }

        .landing-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 60px;
        }

        .landing-btn {
            padding: 14px 32px;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
            letter-spacing: 0.3px;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
            box-shadow: 0 2px 8px rgba(107, 68, 35, 0.2);
        }

        .btn-primary:hover {
            background: var(--secondary);
            box-shadow: 0 4px 12px rgba(107, 68, 35, 0.3);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--primary);
            border: 1.5px solid var(--grey);
        }

        .btn-secondary:hover {
            background: var(--light);
            border-color: var(--primary);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            max-width: 900px;
            margin-top: 40px;
        }

        .feature-item {
            background: var(--white);
            padding: 30px 20px;
            border-radius: 8px;
            border: 1px solid var(--grey);
            transition: all 0.2s ease;
        }

        .feature-item:hover {
            border-color: var(--accent);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }

        .feature-icon {
            font-size: 32px;
            margin-bottom: 15px;
        }

        .feature-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .feature-desc {
            font-size: 13px;
            color: var(--grey-dark);
            line-height: 1.5;
        }

        /* Login/Signup Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .auth-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 450px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 10px;
        }

        .auth-logo img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-bottom: 10px;
        }

        .auth-logo-text {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        .auth-title {
            font-size: 24px;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .auth-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }

        .auth-switch a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        /* Student Registration Form */
        .registration-page {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 20px;
            display: none;
        }

        .registration-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        .registration-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .ministry-name {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .registration-title {
            font-size: 24px;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .year-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .year-card {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .year-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .year-card.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .year-card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .year-card-price {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .year-card-desc {
            font-size: 14px;
            color: #666;
        }

        .payment-summary {
            background: var(--light);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .summary-total {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            border-top: 2px solid #e0e0e0;
            padding-top: 10px;
            margin-top: 10px;
        }

        /* Dashboard Styles */
        .dashboard {
            display: none;
            min-height: 100vh;
            background: var(--lighter);
        }

        .top-nav {
            background: var(--white);
            padding: 18px 40px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--grey);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-logo img {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        .nav-logo-text {
            font-size: 22px;
            font-weight: 300;
            color: var(--primary);
            letter-spacing: -0.5px;
        }

        .nav-ministry {
            font-size: 16px;
            color: var(--dark);
            font-weight: 500;
            padding-left: 20px;
            border-left: 1px solid var(--grey);
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            position: relative;
        }

        .stat-card h3 {
            color: #999;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .stat-label {
            color: #999;
            font-size: 14px;
        }

        /* Revenue Privacy Styles */
        .revenue-hidden {
            filter: blur(8px);
            user-select: none;
            pointer-events: none;
        }

        .reveal-revenue-btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .reveal-revenue-btn:hover {
            background: var(--secondary);
            transform: translateY(-1px);
        }

        /* Visibility Toggle Styles */
        .visibility-toggle {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--light);
            border: 2px solid var(--grey);
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .visibility-toggle.visible {
            background: #d4f4dd;
            border-color: #2e7d32;
            color: #2e7d32;
        }

        .visibility-toggle.hidden {
            background: #f5f5f5;
            border-color: #999;
            color: #999;
        }

        .visibility-toggle:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tabs {
            background: white;
            padding: 5px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            gap: 5px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }

        .tab {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            color: #666;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .main-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }

        .student-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .student-table th {
            background: var(--light);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #666;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid #e0e0e0;
        }

        .student-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-paid {
            background: #d4f4dd;
            color: #2e7d32;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .logout-btn {
            padding: 8px 20px;
            background: transparent;
            color: var(--danger);
            border: 2px solid var(--danger);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
        }

        /* Bulk Actions Styles */
        .bulk-actions-bar {
            background: var(--light);
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 15px;
        }

        .bulk-actions-bar.active {
            display: flex;
        }

        .bulk-action-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .bulk-action-btn:hover {
            background: var(--primary);
            color: white;
        }

        .checkbox-cell {
            width: 40px;
        }

        .student-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 3000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--dark);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            color: var(--danger);
        }

        /* Workflow Styles */
        .workflow-card {
            background: white;
            border: 2px solid var(--light);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .workflow-card:hover {
            border-color: var(--primary);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .workflow-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .workflow-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .workflow-toggle {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .workflow-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        .workflow-toggle input:checked + .toggle-slider {
            background-color: var(--success);
        }

        .workflow-toggle input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .workflow-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .workflow-stats {
            display: flex;
            gap: 20px;
            font-size: 13px;
            color: #999;
        }

        /* Financial Tools Styles */
        .payment-link-box {
            background: var(--light);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .payment-link-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
        }

        .copy-btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .copy-btn:hover {
            background: var(--secondary);
        }

        .family-account-card {
            background: white;
            border: 2px solid var(--light);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .family-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .family-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .family-balance {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
        }

        .student-list {
            list-style: none;
            padding: 0;
        }

        .student-list li {
            padding: 10px;
            background: var(--light);
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* QR Code Styles */
        .qr-container {
            text-align: center;
            padding: 20px;
        }

        .qr-code-display {
            display: inline-block;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 30px;
            background: var(--light);
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        /* Scholarship Badge */
        .scholarship-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: #e3f2fd;
            color: #1976d2;
        }

        /* Action Buttons */
        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            margin-right: 5px;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-info {
            background: var(--primary);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Grid Layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        /* Card Styles */
        .info-card {
            background: var(--light);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .info-card h4 {
            margin-bottom: 10px;
            color: var(--dark);
        }

        .info-card p {
            color: #666;
            font-size: 14px;
            margin: 5px 0;
        }

        /* Timeline Styles */
        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }

        .timeline-item:before {
            content: '';
            position: absolute;
            left: -23px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
        }

        .timeline-item:after {
            content: '';
            position: absolute;
            left: -18px;
            top: 17px;
            width: 2px;
            height: calc(100% - 12px);
            background: var(--light);
        }

        .timeline-item:last-child:after {
            display: none;
        }

        .timeline-date {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
        }

        .timeline-content {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--light);
        }

        /* Sign-In Sheet Styles */
        .signin-sheet {
            background: white;
            padding: 40px;
            border: 2px solid #333;
            margin: 20px 0;
        }

        .signin-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #333;
            padding-bottom: 20px;
        }

        .signin-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .signin-date {
            font-size: 18px;
            color: #666;
        }

        .signin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .signin-table th,
        .signin-table td {
            border: 1px solid #333;
            padding: 12px;
            text-align: left;
        }

        .signin-table th {
            background: #f0f0f0;
            font-weight: bold;
        }

        .signin-table .signature-cell {
            width: 200px;
        }

        .signin-table .time-cell {
            width: 100px;
        }

        .signin-table .notes-cell {
            width: 150px;
        }

        .print-button-container {
            margin: 20px 0;
            text-align: center;
        }

        @media print {
            .no-print {
                display: none !important;
            }
            
            .signin-sheet {
                border: 2px solid #000;
                page-break-inside: avoid;
            }
            
            body {
                background: white;
            }
            
            .dashboard {
                background: white;
            }
        }

        @media (max-width: 768px) {
            .landing-buttons {
                flex-direction: column;
                width: 100%;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .year-selection {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }

            .bulk-actions-bar {
                flex-wrap: wrap;
            }

            .modal-content {
                padding: 20px;
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div id="landingPage" class="landing-page">
        <div class="landing-logo">
            <img src="SOP IG.jpg" alt="School of Purpose Logo">
            <div class="landing-logo-text">School of Purpose</div>
        </div>
        <div class="landing-tagline">Ministry Education Management Made Simple</div>
        
        <div class="landing-buttons">
            <button class="landing-btn btn-primary" onclick="showLogin(); return false;">SOP Admin Login</button>
            <a href="student-portal.html" class="landing-btn btn-primary" style="text-decoration: none;">SOP Student Login</a>
            <button class="landing-btn btn-secondary" onclick="showStudentRegistration(); return false;">New SOP Student Registration</button>
        </div>

        <div class="features-grid">
            <div class="feature-item">
                <div class="feature-icon">üë•</div>
                <div class="feature-title">Student Management</div>
                <div class="feature-desc">Track enrollment, attendance, and progress</div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">üí≥</div>
                <div class="feature-title">Payment Processing</div>
                <div class="feature-desc">Secure online payments and tracking</div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">üìß</div>
                <div class="feature-title">Communication Hub</div>
                <div class="feature-desc">Email and SMS messaging</div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">üìä</div>
                <div class="feature-title">Analytics</div>
                <div class="feature-desc">Detailed reports and insights</div>
            </div>
        </div>
    </div>

    <!-- Ministry Login Modal -->
    <div id="loginModal" class="auth-modal">
        <div class="auth-content">
            <div class="auth-header">
                <div class="auth-logo">
                    <img src="SOP IG.jpg" alt="School of Purpose Logo">
                    <div class="auth-logo-text">School of Purpose</div>
                </div>
                <div class="auth-title">Ministry Login</div>
            </div>
            
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="loginEmail" required placeholder="ministry@email.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" required placeholder="Enter your password">
                </div>
                <button type="submit" class="auth-btn">Sign In</button>
            </form>
            
            <div class="auth-switch">
                Don't have an account? <a href="#" onclick="showSignup()">Create Ministry Account</a>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <a href="#" onclick="closeModal()" style="color: #999;">Cancel</a>
            </div>
        </div>
    </div>

    <!-- Ministry Signup Modal -->
    <div id="signupModal" class="auth-modal">
        <div class="auth-content">
            <div class="auth-header">
                <div class="auth-logo">
                    <img src="SOP IG.jpg" alt="School of Purpose Logo">
                    <div class="auth-logo-text">School of Purpose</div>
                </div>
                <div class="auth-title">Create Ministry Account</div>
            </div>
            
            <form onsubmit="handleSignup(event)">
                <div class="form-group">
                    <label>Ministry Name</label>
                    <input type="text" id="ministryName" required placeholder="e.g., School of Purpose">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" id="firstName" required placeholder="John">
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" id="lastName" required placeholder="Doe">
                    </div>
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="signupEmail" required placeholder="admin@ministry.com">
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="phone" required placeholder="(555) 123-4567">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="signupPassword" required placeholder="Create a strong password">
                </div>
                <div class="form-group">
                    <label>Year 1 Tuition Amount</label>
                    <input type="number" id="year1Tuition" required value="250" placeholder="250">
                </div>
                <div class="form-group">
                    <label>Year 2 Tuition Amount</label>
                    <input type="number" id="year2Tuition" required value="280" placeholder="280">
                </div>
                <button type="submit" class="auth-btn">Create Account</button>
            </form>
            
            <div class="auth-switch">
                Already have an account? <a href="#" onclick="showLogin()">Sign In</a>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <a href="#" onclick="closeModal()" style="color: #999;">Cancel</a>
            </div>
        </div>
    </div>

    <!-- Student Registration Page -->
    <div id="studentRegistration" class="registration-page">
        <div class="registration-container">
            <div class="registration-header">
                <div class="ministry-name">School of Purpose</div>
                <div class="registration-title">Student Registration</div>
                <p style="color: #666;">Join our ministry education program</p>
            </div>

            <form onsubmit="handleStudentRegistration(event)">
                <div class="year-selection">
                    <div class="year-card" onclick="selectYear(1, this)">
                        <div class="year-card-title">Year 1</div>
                        <div class="year-card-price">$250</div>
                        <div class="year-card-desc">First Year Program</div>
                    </div>
                    <div class="year-card" onclick="selectYear(2, this)">
                        <div class="year-card-title">Year 2</div>
                        <div class="year-card-price">$280</div>
                        <div class="year-card-desc">Second Year Program</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>First Name *</label>
                        <input type="text" id="studentFirstName" required placeholder="Enter first name">
                    </div>
                    <div class="form-group">
                        <label>Last Name *</label>
                        <input type="text" id="studentLastName" required placeholder="Enter last name">
                    </div>
                </div>

                <div class="form-group">
                    <label>Email Address *</label>
                    <input type="email" id="studentEmail" required placeholder="student@email.com">
                </div>

                <div class="form-group">
                    <label>Phone Number *</label>
                    <input type="tel" id="studentPhone" required placeholder="(555) 123-4567">
                </div>

                <div class="form-group">
                    <label>Date of Birth *</label>
                    <input type="date" id="studentDOB" required>
                </div>

                <div class="form-group">
                    <label>Parent/Guardian Name (if under 18)</label>
                    <input type="text" id="parentName" placeholder="Parent/Guardian full name">
                </div>

                <div class="form-group">
                    <label>Parent/Guardian Phone</label>
                    <input type="tel" id="parentPhone" placeholder="(555) 123-4567">
                </div>

                <div class="form-group">
                    <label>Payment Plan *</label>
                    <select id="paymentPlan" required onchange="updatePaymentSummary()">
                        <option value="">Select payment plan</option>
                        <option value="full">Full Payment (Save 5%)</option>
                        <option value="semester">Two Payments (per semester)</option>
                        <option value="monthly">Monthly Installments</option>
                        <option value="scholarship">Scholarship Application</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>How did you hear about us?</label>
                    <select id="referralSource">
                        <option value="">Select an option</option>
                        <option value="friend">Friend/Family</option>
                        <option value="church">Church Announcement</option>
                        <option value="social">Social Media</option>
                        <option value="website">Website</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Prayer Requests or Special Notes</label>
                    <textarea id="studentNotes" rows="3" placeholder="Share any prayer requests or special accommodations needed"></textarea>
                </div>

                <div class="payment-summary" id="paymentSummary" style="display: none;">
                    <div class="summary-row">
                        <span>Program Year:</span>
                        <span id="selectedYear">Year 1</span>
                    </div>
                    <div class="summary-row">
                        <span>Base Tuition:</span>
                        <span id="baseTuition">$250</span>
                    </div>
                    <div class="summary-row" id="discountRow" style="display: none;">
                        <span>Discount:</span>
                        <span id="discount">-$12.50</span>
                    </div>
                    <div class="summary-total">
                        <span>Total Due:</span>
                        <span id="totalDue">$250</span>
                    </div>
                </div>

                <button type="submit" class="auth-btn">Complete Registration</button>
                
                <div style="text-align: center; margin-top: 20px;">
                    <a href="#" onclick="backToLanding()" style="color: #999;">‚Üê Back to Home</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <div class="top-nav">
            <div class="nav-brand">
            <div class="nav-logo">
                <img src="SOP IG.jpg" alt="School of Purpose Logo">
                <div class="nav-logo-text">School of Purpose</div>
            </div>
                <div class="nav-ministry" id="dashboardMinistryName">School of Purpose</div>
            </div>
            <div class="nav-user">
                <button onclick="showNotifications()" style="padding: 8px 15px; background: white; border: 2px solid var(--primary); color: var(--primary); border-radius: 8px; cursor: pointer;">
                    üîî Notifications <span style="background: var(--danger); color: white; padding: 2px 6px; border-radius: 10px; font-size: 12px;">3</span>
                </button>
                <div class="user-avatar" id="userAvatar">JD</div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="container">
            <!-- Revenue Privacy Toggle -->
            <div style="margin-bottom: 20px; text-align: right;">
                <button class="reveal-revenue-btn" id="revenueToggleBtn" onclick="toggleRevenue()">
                    üîí Show Revenue
                </button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Students</h3>
                    <div class="stat-value">125</div>
                    <div class="stat-label">‚Üë 12% from last month</div>
                </div>
                <div class="stat-card revenue-card revenue-hidden" id="revenueCard1">
                    <h3>Revenue This Month</h3>
                    <div class="stat-value">$8,750</div>
                    <div class="stat-label">85% collected</div>
                </div>
                <div class="stat-card">
                    <h3>Year 1 Students</h3>
                    <div class="stat-value">78</div>
                    <div class="stat-label">$250 per student</div>
                </div>
                <div class="stat-card">
                    <h3>Year 2 Students</h3>
                    <div class="stat-value">47</div>
                    <div class="stat-label">$280 per student</div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('students', this)">üë• Students</button>
                <button class="tab" onclick="switchTab('materials', this)">üìö Upload Materials</button>
                <button class="tab" onclick="switchTab('announcements', this)">üì¢ Announcements</button>
                <button class="tab" onclick="switchTab('attendance', this)">üìã Attendance</button>
                <button class="tab" onclick="switchTab('registrations', this)">üìù New Registrations</button>
                <button class="tab" onclick="switchTab('payments', this)">üí∞ Payments</button>
                <button class="tab" onclick="switchTab('workflows', this)">üîÑ Workflows</button>
                <button class="tab" onclick="switchTab('financial', this)">üí≥ Financial Tools</button>
                <button class="tab" onclick="switchTab('communication', this)">üìß Messages</button>
                <button class="tab" onclick="switchTab('reports', this)">üìä Reports</button>
                <button class="tab" onclick="switchTab('settings', this)">‚öôÔ∏è Settings</button>
            </div>

            <div class="main-content">
                <div id="students-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>Student Roster</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="action-btn btn-success" onclick="exportToCSV()">üì• Export CSV</button>
                            <button class="action-btn btn-info" onclick="showBulkActions()">üìã Bulk Actions</button>
                        </div>
                    </div>
                    
                    <!-- Search and Filter Bar -->
                    <div style="background: var(--light); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <div class="grid-3">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>üîç Search Students</label>
                                <input type="text" id="studentSearch" placeholder="Search by name, email, or phone..." onkeyup="filterStudents()" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>Filter by Year</label>
                                <select id="yearFilter" onchange="filterStudents()" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                                    <option value="all">All Years</option>
                                    <option value="1">Year 1 Only</option>
                                    <option value="2">Year 2 Only</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>Filter by Status</label>
                                <select id="statusFilter" onchange="filterStudents()" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                                    <option value="all">All Statuses</option>
                                    <option value="PAID">Paid Only</option>
                                    <option value="PENDING">Pending Only</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top: 10px; color: #666; font-size: 14px;">
                            <span id="filterResults">Showing all 58 students</span>
                        </div>
                    </div>
                    
                    <!-- Bulk Actions Bar -->
                    <div id="bulkActionsBar" class="bulk-actions-bar">
                        <span id="selectedCount">0 students selected</span>
                        <button class="bulk-action-btn" onclick="bulkMarkAttendance()">‚úì Mark Attendance</button>
                        <button class="bulk-action-btn" onclick="bulkRecordPayment()">üí∞ Record Payment</button>
                        <button class="bulk-action-btn" onclick="bulkSendMessage()">üìß Send Message</button>
                        <button class="bulk-action-btn" onclick="bulkPromote()">‚¨ÜÔ∏è Promote Year</button>
                        <button class="bulk-action-btn" onclick="bulkGenerateInvoices()">üìÑ Generate Invoices</button>
                        <button class="bulk-action-btn" onclick="clearSelection()" style="background: var(--danger); color: white; border-color: var(--danger);">‚úï Clear</button>
                    </div>
                    
                    <table class="student-table">
                        <thead>
                            <tr>
                                <th class="checkbox-cell">
                                    <input type="checkbox" class="student-checkbox" id="selectAll" onchange="toggleSelectAll(this)">
                                </th>
                                <th>Name</th>
                                <th>Year</th>
                                <th>Email</th>
                                <th>Payment Status</th>
                                <th>Balance</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentTableBody">
                            <tr>
                                <td class="checkbox-cell">
                                    <input type="checkbox" class="student-checkbox" onchange="updateSelectedCount()">
                                </td>
                                <td><strong>Sarah Johnson</strong></td>
                                <td>Year 1</td>
                                <td>sarah.j@email.com</td>
                                <td><span class="status-badge status-paid">PAID</span></td>
                                <td>$0</td>
                                <td>
                                    <button class="action-btn btn-info" style="padding: 5px 10px;" onclick="viewStudent(0)">View</button>
                                    <button class="action-btn btn-success" style="padding: 5px 10px;" onclick="generatePaymentLink(0)">üí≥ Pay Link</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="checkbox-cell">
                                    <input type="checkbox" class="student-checkbox" onchange="updateSelectedCount()">
                                </td>
                                <td><strong>Michael Brown</strong></td>
                                <td>Year 2</td>
                                <td>m.brown@email.com</td>
                                <td><span class="status-badge status-pending">PENDING</span></td>
                                <td>$140</td>
                                <td>
                                    <button class="action-btn btn-info" style="padding: 5px 10px;" onclick="viewStudent(1)">View</button>
                                    <button class="action-btn btn-success" style="padding: 5px 10px;" onclick="generatePaymentLink(1)">üí≥ Pay Link</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="checkbox-cell">
                                    <input type="checkbox" class="student-checkbox" onchange="updateSelectedCount()">
                                </td>
                                <td><strong>Jennifer Davis</strong></td>
                                <td>Year 1</td>
                                <td>jen.davis@email.com</td>
                                <td><span class="status-badge status-paid">PAID</span></td>
                                <td>$0</td>
                                <td>
                                    <button class="action-btn btn-info" style="padding: 5px 10px;" onclick="viewStudent(2)">View</button>
                                    <button class="action-btn btn-success" style="padding: 5px 10px;" onclick="generatePaymentLink(2)">üí≥ Pay Link</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Upload Materials Content (Admin) -->
                <div id="materials-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>üìö Course Materials</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="action-btn btn-success" onclick="showUploadMaterials()">
                                üì§ Upload New Material
                            </button>
                            <button class="action-btn btn-info" onclick="bulkToggleVisibility('materials', true)">
                                üëÅÔ∏è Show All
                            </button>
                            <button class="action-btn btn-warning" onclick="bulkToggleVisibility('materials', false)">
                                üö´ Hide All
                            </button>
                        </div>
                    </div>
                    
                    <div class="info-card" style="margin-bottom: 30px; background: #e3f2fd; border-left: 4px solid var(--primary);">
                        <h4>üìã Material Management</h4>
                        <p>‚Ä¢ Upload PDFs, DOCs, and DOCX files (max 10MB)</p>
                        <p>‚Ä¢ Use visibility toggle to show/hide materials from students</p>
                        <p>‚Ä¢ Organize materials by week or topic</p>
                        <p>‚Ä¢ Students can only see and download visible materials</p>
                        <p>‚Ä¢ <strong>Green eye = Visible to students</strong> | <strong>Grey eye = Hidden from students</strong></p>
                    </div>
                    
                    <!-- Uploaded Materials List -->
                    <h3 style="margin-bottom: 15px;">üìÅ Uploaded Materials</h3>
                    <div id="materialsList" class="workflow-card">
                        <p style="color: #666; text-align: center; padding: 20px;">No materials uploaded yet.</p>
                    </div>
                </div>

                <!-- Announcements Content (Admin) -->
                <div id="announcements-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>üì¢ Manage Announcements</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="action-btn btn-success" onclick="showAddAnnouncement()">
                                ‚ûï Add Announcement
                            </button>
                            <button class="action-btn btn-info" onclick="bulkToggleVisibility('announcements', true)">
                                üëÅÔ∏è Show All
                            </button>
                            <button class="action-btn btn-warning" onclick="bulkToggleVisibility('announcements', false)">
                                üö´ Hide All
                            </button>
                        </div>
                    </div>
                    
                    <div class="info-card" style="margin-bottom: 30px; background: #e3f2fd; border-left: 4px solid var(--primary);">
                        <h4>üìã Announcement Management</h4>
                        <p>‚Ä¢ Post important updates, schedule changes, and event information</p>
                        <p>‚Ä¢ Use visibility toggle to show/hide announcements from students</p>
                        <p>‚Ä¢ Set priority levels (normal, important, urgent)</p>
                        <p>‚Ä¢ Students can only see visible announcements</p>
                        <p>‚Ä¢ <strong>Green eye = Visible to students</strong> | <strong>Grey eye = Hidden from students</strong></p>
                    </div>
                    
                    <!-- Announcements List -->
                    <h3 style="margin-bottom: 15px;">üì¢ Current Announcements</h3>
                    <div id="announcementsList">
                        <p style="color: #666; text-align: center; padding: 20px;">No announcements yet.</p>
                    </div>
                </div>
                    
                    <!-- Quick Check-In Section -->
                    <div class="workflow-card" style="background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; margin-bottom: 30px;">
                        <h3 style="color: white; margin-bottom: 15px;">‚úì Quick Check-In</h3>
                        <p style="margin-bottom: 20px; opacity: 0.9;">Check in for today's class</p>
                        <button class="action-btn" onclick="studentCheckIn()" style="background: white; color: var(--primary); padding: 12px 30px; font-size: 16px;">
                            ‚úì Check In Now
                        </button>
                        <p style="margin-top: 15px; font-size: 14px; opacity: 0.8;">
                            <span id="checkedInToday">0</span> students checked in today
                        </p>
                    </div>

                    <!-- Support Our Ministry -->
                    <div class="workflow-card" style="background: var(--light); border: 2px solid var(--accent); margin-top: 30px;">
                        <div style="text-align: center;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;">üíù Support Our Ministry</h3>
                            <p style="color: #666; margin-bottom: 20px; line-height: 1.6;">
                                Your generous donations help us continue providing quality ministry education and support our community programs. 
                                Every contribution makes a difference in the lives of our ministry, students and their families.
                            </p>
                            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                                <button class="action-btn btn-success" onclick="makeDonation('one-time')" style="padding: 14px 30px; font-size: 16px;">
                                    üí≥ One-Time Donation
                                </button>
                                <button class="action-btn btn-info" onclick="makeDonation('monthly')" style="padding: 14px 30px; font-size: 16px;">
                                    üîÑ Monthly Giving
                                </button>
                            </div>
                            <p style="margin-top: 20px; font-size: 14px; color: var(--grey-dark);">
                                ‚úì Tax-deductible ‚Ä¢ ‚úì Secure payment ‚Ä¢ ‚úì 100% goes to ministry programs
                            </p>
                        </div>
                    </div>

                    <!-- Recent Announcements -->
                    <h3 style="margin: 30px 0 20px 0;">üì¢ Recent Announcements</h3>
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-date">Today, 9:00 AM</div>
                            <div class="timeline-content">
                                <strong>Class Schedule Update</strong><br>
                                Wednesday's class will start 30 minutes earlier at 5:30 PM this week.
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">Yesterday</div>
                            <div class="timeline-content">
                                <strong>New Study Materials Available</strong><br>
                                Check out the new study guide for this month's topic on faith and works.
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">Dec 10</div>
                            <div class="timeline-content">
                                <strong>Community Service Opportunity</strong><br>
                                Join us this Saturday for our community outreach program. Sign up at the front desk.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attendance/Sign-In Sheet Content -->
                <div id="attendance-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>Attendance & Sign-In Sheets</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="action-btn btn-primary" onclick="window.open('student-signin.html', '_blank')" style="background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); padding: 12px 24px; font-size: 16px;">
                                ‚úì Interactive Sign-In Checklist
                            </button>
                            <button class="action-btn btn-info" onclick="generateSignInSheet('all')">üìÑ Generate All Students</button>
                            <button class="action-btn btn-success" onclick="generateSignInSheet('year1')">Year 1 Sheet</button>
                            <button class="action-btn btn-warning" onclick="generateSignInSheet('year2')">Year 2 Sheet</button>
                        </div>
                    </div>

                    <div class="info-card" style="margin-bottom: 30px; background: #e3f2fd; border-left: 4px solid var(--primary);">
                        <h4>‚úì Interactive Sign-In Checklist</h4>
                        <p>‚Ä¢ Click the "Interactive Sign-In Checklist" button above to launch the digital check-in system</p>
                        <p>‚Ä¢ Students can walk in and check off their names with a simple click</p>
                        <p>‚Ä¢ Displays only first initial + last name (e.g., "A. Taylor" for "Alexa Taylor")</p>
                        <p>‚Ä¢ Separate tabs for All Students, Year 1, and Year 2</p>
                        <p>‚Ä¢ Real-time tracking with timestamps for each check-in</p>
                        <p>‚Ä¢ Export check-in data to CSV or print for records</p>
                    </div>

                    <div class="grid-2" style="margin-bottom: 30px;">
                        <div class="info-card">
                            <h4>üìä Attendance Statistics</h4>
                            <p><strong>Today's Attendance:</strong> 52 / 58 students (89.7%)</p>
                            <p><strong>This Week Average:</strong> 91.2%</p>
                            <p><strong>This Month Average:</strong> 88.5%</p>
                        </div>
                        <div class="info-card">
                            <h4>‚ö†Ô∏è Attendance Alerts</h4>
                            <p><strong>2+ Absences:</strong> 3 students</p>
                            <p><strong>Late Arrivals (This Week):</strong> 8 students</p>
                            <p><strong>Perfect Attendance:</strong> 42 students</p>
                        </div>
                    </div>

                    <div id="signInSheetContainer" class="no-print">
                        <p style="color: #666; text-align: center; padding: 40px;">
                            Click one of the buttons above to generate a sign-in sheet
                        </p>
                    </div>
                </div>

                <div id="registrations-content" style="display: none;">
                    <h2 style="margin-bottom: 20px;">New Student Registrations</h2>
                    <p>5 new registrations pending approval</p>
                    <!-- Registration list would go here -->
                </div>

                <!-- Workflows Content -->
                <div id="workflows-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>Automated Workflows</h2>
                        <button class="action-btn btn-info" onclick="showWorkflowSettings()">‚öôÔ∏è Configure</button>
                    </div>
                    
                    <div class="workflow-card">
                        <div class="workflow-header">
                            <div class="workflow-title">üìß Welcome Email Automation</div>
                            <label class="workflow-toggle">
                                <input type="checkbox" checked onchange="toggleWorkflow('welcome')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="workflow-description">Automatically send welcome emails to new students upon registration</div>
                        <div class="workflow-stats">
                            <span>‚úì 45 sent this month</span>
                            <span>‚è± Last run: 2 hours ago</span>
                        </div>
                    </div>

                    <div class="workflow-card">
                        <div class="workflow-header">
                            <div class="workflow-title">üí∞ Payment Reminder Sequences</div>
                            <label class="workflow-toggle">
                                <input type="checkbox" checked onchange="toggleWorkflow('payment-reminders')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="workflow-description">Send automated reminders 7, 3, and 1 day before payment due dates</div>
                        <div class="workflow-stats">
                            <span>‚úì 23 reminders sent</span>
                            <span>‚è± Next run: Tomorrow 9:00 AM</span>
                        </div>
                    </div>

                    <div class="workflow-card">
                        <div class="workflow-header">
                            <div class="workflow-title">üìä Attendance Alerts</div>
                            <label class="workflow-toggle">
                                <input type="checkbox" checked onchange="toggleWorkflow('attendance')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="workflow-description">Alert parents after 2 consecutive absences</div>
                        <div class="workflow-stats">
                            <span>‚úì 8 alerts sent</span>
                            <span>‚è± Monitoring active</span>
                        </div>
                    </div>

                    <div class="workflow-card">
                        <div class="workflow-header">
                            <div class="workflow-title">üéÇ Birthday & Anniversary Greetings</div>
                            <label class="workflow-toggle">
                                <input type="checkbox" checked onchange="toggleWorkflow('birthdays')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="workflow-description">Send personalized birthday wishes and ministry anniversary messages</div>
                        <div class="workflow-stats">
                            <span>‚úì 12 greetings sent</span>
                            <span>‚è± 3 upcoming this week</span>
                        </div>
                    </div>

                    <div class="workflow-card">
                        <div class="workflow-header">
                            <div class="workflow-title">üéì Course Completion Certificates</div>
                            <label class="workflow-toggle">
                                <input type="checkbox" checked onchange="toggleWorkflow('certificates')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="workflow-description">Automatically generate and send certificates upon course completion</div>
                        <div class="workflow-stats">
                            <span>‚úì 34 certificates issued</span>
                            <span>‚è± End of year processing</span>
                        </div>
                    </div>

                    <div class="workflow-card">
                        <div class="workflow-header">
                            <div class="workflow-title">üîÑ Re-enrollment Campaigns</div>
                            <label class="workflow-toggle">
                                <input type="checkbox" onchange="toggleWorkflow('reenrollment')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="workflow-description">Send re-enrollment invitations for next year's program</div>
                        <div class="workflow-stats">
                            <span>‚è∏ Scheduled for May</span>
                            <span>‚è± 125 students eligible</span>
                        </div>
                    </div>
                </div>

                <!-- Financial Tools Content -->
                <div id="financial-content" style="display: none;">
                    <h2 style="margin-bottom: 20px;">Smart Financial Tools</h2>
                    
                    <div class="grid-2">
                        <div class="info-card">
                            <h4>üí≥ Payment Links</h4>
                            <p>Generate secure payment links for students</p>
                            <button class="action-btn btn-info" onclick="showPaymentLinkGenerator()" style="margin-top: 10px;">Generate Link</button>
                        </div>
                        
                        <div class="info-card">
                            <h4>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Accounts</h4>
                            <p>Link multiple students under one family account</p>
                            <button class="action-btn btn-info" onclick="showFamilyAccounts()" style="margin-top: 10px;">Manage Families</button>
                        </div>
                        
                        <div class="info-card">
                            <h4>üéì Scholarships & Discounts</h4>
                            <p>Manage scholarship applications and discounts</p>
                            <button class="action-btn btn-info" onclick="showScholarships()" style="margin-top: 10px;">View Applications</button>
                        </div>
                        
                        <div class="info-card">
                            <h4>üíù Donation Tracking</h4>
                            <p>Track donations separate from tuition payments</p>
                            <button class="action-btn btn-info" onclick="showDonations()" style="margin-top: 10px;">View Donations</button>
                        </div>
                    </div>

                    <h3 style="margin: 30px 0 15px 0;">Recent Transactions</h3>
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-date">Today, 2:30 PM</div>
                            <div class="timeline-content">
                                <strong>Payment Received</strong> - Sarah Johnson paid $250 (Full Year 1 tuition)
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">Today, 11:15 AM</div>
                            <div class="timeline-content">
                                <strong>Partial Payment</strong> - Michael Brown paid $70 (Remaining: $70)
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">Yesterday, 4:45 PM</div>
                            <div class="timeline-content">
                                <strong>Scholarship Approved</strong> - Emma Wilson received 50% scholarship ($125)
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">Yesterday, 10:00 AM</div>
                            <div class="timeline-content">
                                <strong>Donation Received</strong> - Anonymous donor contributed $500
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Communication/Messages Content -->
                <div id="communication-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>Announcements Management</h2>
                        <button class="action-btn btn-success" onclick="createNewAnnouncement()">‚ûï Create Announcement</button>
                    </div>
                    
                    <div class="info-card" style="background: #e3f2fd; border-left: 4px solid var(--primary);">
                        <h4>üì¢ How Announcements Work</h4>
                        <p>‚Ä¢ Create announcements that appear in the student portal</p>
                        <p>‚Ä¢ Send announcement URLs directly to students via email</p>
                        <p>‚Ä¢ Students can access announcements by logging into their portal</p>
                        <p>‚Ä¢ Manage and delete old announcements</p>
                    </div>

                    <h3 style="margin: 30px 0 15px 0;">Active Announcements</h3>
                    <div id="announcementsList">
                        <!-- Announcements will be loaded here -->
                    </div>
                </div>

                <div id="other-content" style="display: none;">
                    <!-- Other tab contents -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modals for New Features -->
    
    <!-- QR Attendance Modal -->
    <div id="qrAttendanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">QR Code Attendance Check-In</h3>
                <button class="close-modal" onclick="closeQRModal()">√ó</button>
            </div>
            <div class="qr-container">
                <p style="margin-bottom: 20px;">Students can scan this QR code to check in for today's class</p>
                <div id="qrCodeDisplay" class="qr-code-display"></div>
                <p style="margin-top: 20px; color: #666;">QR Code valid for: <strong id="qrTimer">15:00</strong></p>
                <button class="action-btn btn-info" onclick="generateNewQR()" style="margin-top: 15px;">üîÑ Generate New Code</button>
                <button class="action-btn btn-success" onclick="downloadQR()" style="margin-top: 15px;">‚¨áÔ∏è Download QR Code</button>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: var(--light); border-radius: 10px;">
                <h4 style="margin-bottom: 10px;">Today's Check-ins: <span id="checkinCount">0</span></h4>
                <div id="checkinList" style="font-size: 14px; color: #666;"></div>
            </div>
        </div>
    </div>

    <!-- Bulk Payment Modal -->
    <div id="bulkPaymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Record Bulk Payments</h3>
                <button class="close-modal" onclick="closeBulkPaymentModal()">√ó</button>
            </div>
            <div class="form-group">
                <label>Payment Amount per Student</label>
                <input type="number" id="bulkPaymentAmount" placeholder="Enter amount">
            </div>
            <div class="form-group">
                <label>Payment Method</label>
                <select id="bulkPaymentMethod">
                    <option value="cash">Cash</option>
                    <option value="check">Check</option>
                    <option value="card">Credit/Debit Card</option>
                    <option value="online">Online Transfer</option>
                </select>
            </div>
            <div class="form-group">
                <label>Payment Date</label>
                <input type="date" id="bulkPaymentDate" value="">
            </div>
            <div class="form-group">
                <label>Notes (Optional)</label>
                <textarea id="bulkPaymentNotes" rows="3" placeholder="Add any notes about this payment batch"></textarea>
            </div>
            <div style="margin: 20px 0; padding: 15px; background: var(--light); border-radius: 10px;">
                <strong>Selected Students: <span id="bulkPaymentStudentCount">0</span></strong>
                <p style="margin-top: 10px; color: #666;">Total Amount: $<span id="bulkPaymentTotal">0</span></p>
            </div>
            <button class="action-btn btn-success" onclick="processBulkPayment()" style="width: 100%;">üí∞ Record Payments</button>
        </div>
    </div>

    <!-- Bulk Message Modal -->
    <div id="bulkMessageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Send Bulk Message</h3>
                <button class="close-modal" onclick="closeBulkMessageModal()">√ó</button>
            </div>
            <div class="form-group">
                <label>Message Type</label>
                <select id="messageType">
                    <option value="email">Email</option>
                    <option value="sms">SMS Text</option>
                    <option value="both">Email + SMS</option>
                </select>
            </div>
            <div class="form-group">
                <label>Subject (for emails)</label>
                <input type="text" id="messageSubject" placeholder="Enter email subject">
            </div>
            <div class="form-group">
                <label>Message</label>
                <textarea id="messageBody" rows="6" placeholder="Type your message here...

Use {{firstName}} for student's first name
Use {{lastName}} for student's last name
Use {{year}} for their program year"></textarea>
            </div>
            <div style="margin: 20px 0; padding: 15px; background: var(--light); border-radius: 10px;">
                <strong>Recipients: <span id="bulkMessageRecipientCount">0</span> students</strong>
            </div>
            <button class="action-btn btn-info" onclick="sendBulkMessage()" style="width: 100%;">üìß Send Messages</button>
        </div>
    </div>

    <!-- Bulk Promote Modal -->
    <div id="bulkPromoteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Promote Students to Next Year</h3>
                <button class="close-modal" onclick="closeBulkPromoteModal()">√ó</button>
            </div>
            <div style="padding: 20px; background: #fff3cd; border-radius: 10px; margin-bottom: 20px;">
                <strong>‚ö†Ô∏è Important:</strong> This will promote selected students to the next program year and update their tuition accordingly.
            </div>
            <div style="margin: 20px 0; padding: 15px; background: var(--light); border-radius: 10px;">
                <p><strong>Selected Students: <span id="bulkPromoteCount">0</span></strong></p>
                <p style="margin-top: 10px; color: #666;">Year 1 ‚Üí Year 2: <span id="promoteYear1Count">0</span> students</p>
                <p style="color: #666;">Year 2 ‚Üí Graduated: <span id="promoteYear2Count">0</span> students</p>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="sendPromotionEmail"> Send promotion notification emails
                </label>
            </div>
            <button class="action-btn btn-warning" onclick="processBulkPromotion()" style="width: 100%;">‚¨ÜÔ∏è Promote Students</button>
        </div>
    </div>

    <!-- Generate Invoices Modal -->
    <div id="bulkInvoiceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Generate Bulk Invoices</h3>
                <button class="close-modal" onclick="closeBulkInvoiceModal()">√ó</button>
            </div>
            <div class="form-group">
                <label>Invoice Period</label>
                <select id="invoicePeriod">
                    <option value="monthly">Monthly</option>
                    <option value="semester">Semester</option>
                    <option value="annual">Annual</option>
                    <option value="custom">Custom Amount</option>
                </select>
            </div>
            <div class="form-group">
                <label>Due Date</label>
                <input type="date" id="invoiceDueDate">
            </div>
            <div class="form-group">
                <label>Invoice Notes</label>
                <textarea id="invoiceNotes" rows="3" placeholder="Add notes to appear on invoices"></textarea>
            </div>
            <div style="margin: 20px 0; padding: 15px; background: var(--light); border-radius: 10px;">
                <strong>Invoices to Generate: <span id="bulkInvoiceCount">0</span></strong>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="emailInvoices" checked> Email invoices to students/parents
                </label>
            </div>
            <button class="action-btn btn-info" onclick="generateBulkInvoices()" style="width: 100%;">üìÑ Generate Invoices</button>
        </div>
    </div>

    <!-- Payment Link Generator Modal -->
    <div id="paymentLinkModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Generate Payment Link</h3>
                <button class="close-modal" onclick="closePaymentLinkModal()">√ó</button>
            </div>
            <div id="paymentLinkContent">
                <div class="form-group">
                    <label>Student Name</label>
                    <input type="text" id="paymentLinkStudent" readonly>
                </div>
                <div class="form-group">
                    <label>Amount Due</label>
                    <input type="number" id="paymentLinkAmount" placeholder="Enter amount">
                </div>
                <div class="form-group">
                    <label>Payment Description</label>
                    <input type="text" id="paymentLinkDescription" placeholder="e.g., Year 1 Tuition - Semester 1">
                </div>
                <button class="action-btn btn-success" onclick="createPaymentLink()" style="width: 100%; margin-bottom: 20px;">üîó Generate Link</button>
                
                <div id="generatedLinkSection" style="display: none;">
                    <h4 style="margin-bottom: 10px;">Payment Link Generated!</h4>
                    <div class="payment-link-box">
                        <input type="text" id="generatedPaymentLink" class="payment-link-input" readonly>
                        <button class="copy-btn" onclick="copyPaymentLink()">üìã Copy</button>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="action-btn btn-info" onclick="emailPaymentLink()" style="flex: 1;">üìß Email Link</button>
                        <button class="action-btn btn-info" onclick="smsPaymentLink()" style="flex: 1;">üí¨ Text Link</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Family Accounts Modal -->
    <div id="familyAccountsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Family Account Management</h3>
                <button class="close-modal" onclick="closeFamilyAccountsModal()">√ó</button>
            </div>
            <button class="action-btn btn-success" onclick="createNewFamily()" style="margin-bottom: 20px;">‚ûï Create New Family Account</button>
            
            <div id="familyAccountsList">
                <div class="family-account-card">
                    <div class="family-header">
                        <div class="family-name">üë®‚Äçüë©‚Äçüëß Johnson Family</div>
                        <div class="family-balance">$250 due</div>
                    </div>
                    <ul class="student-list">
                        <li>
                            <span>Sarah Johnson - Year 1</span>
                            <span class="status-badge status-paid">PAID</span>
                        </li>
                        <li>
                            <span>David Johnson - Year 2</span>
                            <span class="status-badge status-pending">$250 due</span>
                        </li>
                    </ul>
                    <button class="action-btn btn-info" onclick="manageFamilyAccount(0)" style="margin-top: 10px;">Manage Account</button>
                </div>

                <div class="family-account-card">
                    <div class="family-header">
                        <div class="family-name">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Martinez Family</div>
                        <div class="family-balance">$0 due</div>
                    </div>
                    <ul class="student-list">
                        <li>
                            <span>Carlos Martinez - Year 1</span>
                            <span class="status-badge status-paid">PAID</span>
                        </li>
                        <li>
                            <span>Maria Martinez - Year 1</span>
                            <span class="status-badge status-paid">PAID</span>
                        </li>
                        <li>
                            <span>Sofia Martinez - Year 2</span>
                            <span class="status-badge status-paid">PAID</span>
                        </li>
                    </ul>
                    <button class="action-btn btn-info" onclick="manageFamilyAccount(1)" style="margin-top: 10px;">Manage Account</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scholarships Modal -->
    <div id="scholarshipsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Scholarship Applications</h3>
                <button class="close-modal" onclick="closeScholarshipsModal()">√ó</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="action-btn btn-success" onclick="createScholarship()">‚ûï Create Scholarship</button>
                <button class="action-btn btn-info" onclick="filterScholarships('pending')">Pending Review</button>
                <button class="action-btn btn-info" onclick="filterScholarships('approved')">Approved</button>
            </div>

            <div class="workflow-card">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                    <div>
                        <strong>Emma Wilson - Year 1</strong>
                        <p style="color: #666; font-size: 14px; margin-top: 5px;">Requested: 50% tuition assistance ($125)</p>
                    </div>
                    <span class="status-badge status-pending">PENDING</span>
                </div>
                <p style="font-size: 14px; color: #666; margin-bottom: 10px;">
                    <strong>Reason:</strong> Single parent household, demonstrated financial need
                </p>
                <div style="display: flex; gap: 10px;">
                    <button class="action-btn btn-success" onclick="approveScholarship(0)">‚úì Approve</button>
                    <button class="action-btn btn-danger" onclick="denyScholarship(0)">‚úï Deny</button>
                    <button class="action-btn btn-info" onclick="viewScholarshipDetails(0)">View Details</button>
                </div>
            </div>

            <div class="workflow-card">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                    <div>
                        <strong>James Anderson - Year 2</strong>
                        <p style="color: #666; font-size: 14px; margin-top: 5px;">Approved: 25% tuition discount ($70)</p>
                    </div>
                    <span class="scholarship-badge">APPROVED</span>
                </div>
                <p style="font-size: 14px; color: #666; margin-bottom: 10px;">
                    <strong>Reason:</strong> Academic excellence scholarship
                </p>
                <button class="action-btn btn-info" onclick="viewScholarshipDetails(1)">View Details</button>
            </div>
        </div>
    </div>

    <!-- Donations Modal -->
    <div id="donationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Donation Tracking</h3>
                <button class="close-modal" onclick="closeDonationsModal()">√ó</button>
            </div>
            
            <button class="action-btn btn-success" onclick="recordDonation()" style="margin-bottom: 20px;">‚ûï Record New Donation</button>
            
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                <div class="info-card">
                    <h4>This Month</h4>
                    <p style="font-size: 24px; font-weight: bold; color: var(--primary);">$2,450</p>
                </div>
                <div class="info-card">
                    <h4>This Year</h4>
                    <p style="font-size: 24px; font-weight: bold; color: var(--primary);">$18,750</p>
                </div>
                <div class="info-card">
                    <h4>Total Donors</h4>
                    <p style="font-size: 24px; font-weight: bold; color: var(--primary);">47</p>
                </div>
            </div>

            <h4 style="margin-bottom: 15px;">Recent Donations</h4>
            <table class="student-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Donor</th>
                        <th>Amount</th>
                        <th>Purpose</th>
                        <th>Tax Deductible</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Today</td>
                        <td>Anonymous</td>
                        <td><strong>$500</strong></td>
                        <td>General Fund</td>
                        <td><span class="status-badge status-paid">YES</span></td>
                    </tr>
                    <tr>
                        <td>Yesterday</td>
                        <td>John Smith</td>
                        <td><strong>$250</strong></td>
                        <td>Scholarship Fund</td>
                        <td><span class="status-badge status-paid">YES</span></td>
                    </tr>
                    <tr>
                        <td>Dec 10</td>
                        <td>Grace Community Church</td>
                        <td><strong>$1,000</strong></td>
                        <td>Building Fund</td>
                        <td><span class="status-badge status-paid">YES</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Progress Modal for Bulk Operations -->
    <div id="progressModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Processing...</h3>
            </div>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill" style="width: 0%;">0%</div>
            </div>
            <p id="progressText" style="text-align: center; margin-top: 15px; color: #666;">Initializing...</p>
        </div>
    </div>

    <!-- Create Announcement Modal -->
    <div id="createAnnouncementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Announcement</h3>
                <button class="close-modal" onclick="closeAnnouncementModal()">√ó</button>
            </div>
            <div class="form-group">
                <label>Announcement Title</label>
                <input type="text" id="announcementTitle" placeholder="Enter announcement title">
            </div>
            <div class="form-group">
                <label>Message</label>
                <textarea id="announcementMessage" rows="6" placeholder="Enter announcement message"></textarea>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="emailStudents" checked> Email announcement link to all students
                </label>
            </div>
            <button class="action-btn btn-success" onclick="saveAnnouncement()" style="width: 100%;">üì¢ Post Announcement</button>
        </div>
    </div>

    <!-- Upload Materials Modal -->
    <div id="uploadMaterialsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üì§ Upload Study Materials</h3>
                <button class="close-modal" onclick="closeUploadMaterialsModal()">√ó</button>
            </div>
            
            <div class="form-group">
                <label>Material Title *</label>
                <input type="text" id="materialTitle" placeholder="e.g., Week 5 Study Guide">
            </div>
            
            <div class="form-group">
                <label>Category *</label>
                <select id="materialCategory">
                    <option value="">Select category</option>
                    <option value="study-guide">Study Guide</option>
                    <option value="worksheet">Worksheet</option>
                    <option value="notes">Class Notes</option>
                    <option value="homework">Homework Assignment</option>
                    <option value="reading">Reading Material</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>For Which Class?</label>
                <select id="materialClass">
                    <option value="all">All Classes</option>
                    <option value="monday">Monday - Introduction to Faith</option>
                    <option value="wednesday">Wednesday - Biblical Studies</option>
                    <option value="friday">Friday - Worship & Prayer</option>
                    <option value="sunday">Sunday - Service & Fellowship</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Description</label>
                <textarea id="materialDescription" rows="3" placeholder="Brief description of this material"></textarea>
            </div>
            
            <div class="form-group">
                <label>Upload File (PDF, DOC, DOCX) *</label>
                <input type="file" id="materialFile" accept=".pdf,.doc,.docx" onchange="handleFileSelect(event)" style="padding: 10px; border: 2px dashed var(--grey); border-radius: 8px; background: var(--light);">
                <p style="font-size: 13px; color: var(--grey-dark); margin-top: 8px;">
                    Maximum file size: 10MB
                </p>
            </div>
            
            <div id="filePreview" style="display: none; margin: 15px 0; padding: 15px; background: var(--light); border-radius: 8px;">
                <strong>Selected File:</strong>
                <p id="fileName" style="margin-top: 5px; color: var(--grey-dark);"></p>
                <p id="fileSize" style="font-size: 13px; color: var(--grey-dark);"></p>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="notifyStudents" checked> Send notification to students
                </label>
            </div>
            
            <button class="action-btn btn-success" onclick="uploadMaterial()" style="width: 100%;">
                üì§ Upload Material
            </button>
        </div>
    </div>

    <!-- Add/Edit Class Modal -->
    <div id="addClassModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="classModalTitle">üìÖ Add Class to Schedule</h3>
                <button class="close-modal" onclick="closeAddClassModal()">√ó</button>
            </div>
            
            <div class="form-group">
                <label>Day of Week *</label>
                <select id="classDay">
                    <option value="">Select day</option>
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                    <option value="Saturday">Saturday</option>
                    <option value="Sunday">Sunday</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Class Title *</label>
                <input type="text" id="classTitle" placeholder="e.g., Year 1 Class">
            </div>
            
            <div class="form-group">
                <label>Time *</label>
                <input type="text" id="classTime" placeholder="e.g., 6:30 PM - 9:30 PM">
            </div>
            
            <div class="form-group">
                <label>Topic *</label>
                <input type="text" id="classTopic" placeholder="e.g., Introduction to Faith & Biblical Foundations">
            </div>
            
            <div class="form-group">
                <label>Description</label>
                <textarea id="classDescription" rows="3" placeholder="Brief description of what will be covered in this class"></textarea>
            </div>
            
            <input type="hidden" id="editingClassIndex" value="-1">
            
            <button class="action-btn btn-success" onclick="saveClass()" style="width: 100%;">
                üíæ Save Class
            </button>
        </div>
    </div>

    <!-- Add Announcement Modal -->
    <div id="addAnnouncementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üì¢ Add Announcement</h3>
                <button class="close-modal" onclick="closeAddAnnouncementModal()">√ó</button>
            </div>
            
            <div class="form-group">
                <label>Announcement Title *</label>
                <input type="text" id="announcementTitle" placeholder="e.g., Class Schedule Update">
            </div>
            
            <div class="form-group">
                <label>Message *</label>
                <textarea id="announcementMessage" rows="5" placeholder="Enter your announcement message..."></textarea>
            </div>
            
            <div class="form-group">
                <label>Priority</label>
                <select id="announcementPriority">
                    <option value="normal">Normal</option>
                    <option value="important">Important</option>
                    <option value="urgent">Urgent</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="notifyStudentsAnnouncement" checked> Send notification to students
                </label>
            </div>
            
            <button class="action-btn btn-success" onclick="postAnnouncement()" style="width: 100%;">
                üì¢ Post Announcement
            </button>
        </div>
    </div>

    <!-- Payment Processing Modal -->
    <div id="paymentProcessingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Process Payment</h3>
                <button class="close-modal" onclick="closePaymentProcessingModal()">√ó</button>
            </div>
            
            <div id="paymentStudentInfo" style="background: var(--light); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h4 style="margin-bottom: 10px;">Student Information</h4>
                <p><strong>Name:</strong> <span id="paymentStudentName"></span></p>
                <p><strong>Year:</strong> <span id="paymentStudentYear"></span></p>
                <p><strong>Amount Due:</strong> $<span id="paymentAmountDue"></span></p>
            </div>

            <div class="form-group">
                <label>Payment Amount</label>
                <input type="number" id="paymentAmount" placeholder="Enter amount" step="0.01">
            </div>

            <div class="form-group">
                <label>Payment Method</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px;">
                    <button class="action-btn btn-info" onclick="selectPaymentMethod('stripe')" id="stripeBtn" style="width: 100%;">
                        üí≥ Stripe
                    </button>
                    <button class="action-btn btn-info" onclick="selectPaymentMethod('square')" id="squareBtn" style="width: 100%;">
                        üü¶ Square
                    </button>
                    <button class="action-btn btn-info" onclick="selectPaymentMethod('manual')" id="manualBtn" style="width: 100%;">
                        üíµ Cash/Check
                    </button>
                </div>
            </div>

            <div id="stripePayment" style="display: none; margin-top: 20px;">
                <h4 style="margin-bottom: 15px;">Stripe Payment</h4>
                <div class="info-card">
                    <p style="margin-bottom: 10px;">In production, this would integrate with Stripe's payment form.</p>
                    <div class="form-group">
                        <label>Card Number</label>
                        <input type="text" placeholder="4242 4242 4242 4242" maxlength="19">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Expiry</label>
                            <input type="text" placeholder="MM/YY" maxlength="5">
                        </div>
                        <div class="form-group">
                            <label>CVC</label>
                            <input type="text" placeholder="123" maxlength="4">
                        </div>
                    </div>
                    <button class="action-btn btn-success" onclick="processStripePayment()" style="width: 100%; margin-top: 10px;">
                        üí≥ Pay with Stripe
                    </button>
                </div>
            </div>

            <div id="squarePayment" style="display: none; margin-top: 20px;">
                <h4 style="margin-bottom: 15px;">Square Payment</h4>
                <div class="info-card">
                    <p style="margin-bottom: 10px;">In production, this would integrate with Square's payment form.</p>
                    <div class="form-group">
                        <label>Card Number</label>
                        <input type="text" placeholder="4111 1111 1111 1111" maxlength="19">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Expiry</label>
                            <input type="text" placeholder="MM/YY" maxlength="5">
                        </div>
                        <div class="form-group">
                            <label>CVV</label>
                            <input type="text" placeholder="123" maxlength="4">
                        </div>
                    </div>
                    <button class="action-btn btn-success" onclick="processSquarePayment()" style="width: 100%; margin-top: 10px;">
                        üü¶ Pay with Square
                    </button>
                </div>
            </div>

            <div id="manualPayment" style="display: none; margin-top: 20px;">
                <h4 style="margin-bottom: 15px;">Manual Payment Entry</h4>
                <div class="form-group">
                    <label>Payment Type</label>
                    <select id="manualPaymentType">
                        <option value="cash">Cash</option>
                        <option value="check">Check</option>
                        <option value="money_order">Money Order</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Check/Reference Number (Optional)</label>
                    <input type="text" id="referenceNumber" placeholder="Enter check number or reference">
                </div>
                <div class="form-group">
                    <label>Payment Date</label>
                    <input type="date" id="manualPaymentDate">
                </div>
                <div class="form-group">
                    <label>Notes (Optional)</label>
                    <textarea id="manualPaymentNotes" rows="3" placeholder="Add any notes about this payment"></textarea>
                </div>
                <button class="action-btn btn-success" onclick="processManualPayment()" style="width: 100%;">
                    üíµ Record Payment
                </button>
            </div>
        </div>
    </div>

    <!-- Communication Center Modal -->
    <div id="communicationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Communication Center</h3>
                <button class="close-modal" onclick="closeCommunicationModal()">√ó</button>
            </div>

            <div class="grid-2" style="margin-bottom: 20px;">
                <div class="info-card">
                    <h4>üìß Email Integration</h4>
                    <p>Connect your email service to send automated messages</p>
                    <button class="action-btn btn-info" onclick="setupEmailIntegration()" style="margin-top: 10px;">Setup Email</button>
                </div>
                <div class="info-card">
                    <h4>üí¨ SMS Integration</h4>
                    <p>Connect Twilio to send text messages</p>
                    <button class="action-btn btn-info" onclick="setupSMSIntegration()" style="margin-top: 10px;">Setup SMS</button>
                </div>
            </div>

            <h4 style="margin-bottom: 15px;">Send Message</h4>
            <div class="form-group">
                <label>Recipients</label>
                <select id="messageRecipients">
                    <option value="all">All Students</option>
                    <option value="year1">Year 1 Students</option>
                    <option value="year2">Year 2 Students</option>
                    <option value="pending">Students with Pending Payments</option>
                    <option value="selected">Selected Students</option>
                </select>
            </div>

            <div class="form-group">
                <label>Message Type</label>
                <select id="commMessageType">
                    <option value="email">Email Only</option>
                    <option value="sms">SMS Only</option>
                    <option value="both">Email + SMS</option>
                </select>
            </div>

            <div class="form-group">
                <label>Subject (for emails)</label>
                <input type="text" id="commSubject" placeholder="Enter email subject">
            </div>

            <div class="form-group">
                <label>Message</label>
                <textarea id="commMessage" rows="6" placeholder="Type your message...

Available merge fields:
{{firstName}} - Student's first name
{{lastName}} - Student's last name
{{year}} - Program year
{{balance}} - Outstanding balance
{{ministryName}} - Your ministry name"></textarea>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="scheduleMessage"> Schedule for later
                </label>
            </div>

            <div id="scheduleOptions" style="display: none;">
                <div class="form-row">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="scheduleDate">
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" id="scheduleTime">
                    </div>
                </div>
            </div>

            <button class="action-btn btn-success" onclick="sendCommunication()" style="width: 100%; margin-top: 10px;">
                üì§ Send Message
            </button>
        </div>
    </div>

    <script>
        let selectedYear = null;
        let currentMinistry = {
            name: 'School of Purpose',
            year1Tuition: 250,
            year2Tuition: 280,
            admin: null
        };

        // Generate 58 realistic students (35 Year 1, 23 Year 2)
        const allStudents = [
            // Year 1 Students (35 students) - $250 per semester
            { name: 'Emma Johnson', year: 1, email: 'emma.j@email.com', phone: '(555) 101-2001', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Liam Williams', year: 1, email: 'liam.w@email.com', phone: '(555) 101-2002', status: 'PAID', balance: 0, attendance: 98 },
            { name: 'Olivia Brown', year: 1, email: 'olivia.b@email.com', phone: '(555) 101-2003', status: 'PENDING', balance: 125, attendance: 95 },
            { name: 'Noah Davis', year: 1, email: 'noah.d@email.com', phone: '(555) 101-2004', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Ava Miller', year: 1, email: 'ava.m@email.com', phone: '(555) 101-2005', status: 'PAID', balance: 0, attendance: 97 },
            { name: 'Elijah Wilson', year: 1, email: 'elijah.w@email.com', phone: '(555) 101-2006', status: 'PENDING', balance: 250, attendance: 92 },
            { name: 'Sophia Moore', year: 1, email: 'sophia.m@email.com', phone: '(555) 101-2007', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'James Taylor', year: 1, email: 'james.t@email.com', phone: '(555) 101-2008', status: 'PAID', balance: 0, attendance: 96 },
            { name: 'Isabella Anderson', year: 1, email: 'isabella.a@email.com', phone: '(555) 101-2009', status: 'PAID', balance: 0, attendance: 99 },
            { name: 'Benjamin Thomas', year: 1, email: 'benjamin.t@email.com', phone: '(555) 101-2010', status: 'PENDING', balance: 125, attendance: 94 },
            { name: 'Mia Jackson', year: 1, email: 'mia.j@email.com', phone: '(555) 101-2011', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Lucas White', year: 1, email: 'lucas.w@email.com', phone: '(555) 101-2012', status: 'PAID', balance: 0, attendance: 98 },
            { name: 'Charlotte Harris', year: 1, email: 'charlotte.h@email.com', phone: '(555) 101-2013', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Mason Martin', year: 1, email: 'mason.m@email.com', phone: '(555) 101-2014', status: 'PAID', balance: 0, attendance: 97 },
            { name: 'Amelia Thompson', year: 1, email: 'amelia.t@email.com', phone: '(555) 101-2015', status: 'PENDING', balance: 250, attendance: 89 },
            { name: 'Ethan Garcia', year: 1, email: 'ethan.g@email.com', phone: '(555) 101-2016', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Harper Martinez', year: 1, email: 'harper.m@email.com', phone: '(555) 101-2017', status: 'PAID', balance: 0, attendance: 95 },
            { name: 'Alexander Robinson', year: 1, email: 'alex.r@email.com', phone: '(555) 101-2018', status: 'PAID', balance: 0, attendance: 99 },
            { name: 'Evelyn Clark', year: 1, email: 'evelyn.c@email.com', phone: '(555) 101-2019', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Daniel Rodriguez', year: 1, email: 'daniel.r@email.com', phone: '(555) 101-2020', status: 'PENDING', balance: 125, attendance: 93 },
            { name: 'Abigail Lewis', year: 1, email: 'abigail.l@email.com', phone: '(555) 101-2021', status: 'PAID', balance: 0, attendance: 98 },
            { name: 'Michael Lee', year: 1, email: 'michael.l@email.com', phone: '(555) 101-2022', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Emily Walker', year: 1, email: 'emily.w@email.com', phone: '(555) 101-2023', status: 'PAID', balance: 0, attendance: 96 },
            { name: 'Matthew Hall', year: 1, email: 'matthew.h@email.com', phone: '(555) 101-2024', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Elizabeth Allen', year: 1, email: 'elizabeth.a@email.com', phone: '(555) 101-2025', status: 'PENDING', balance: 250, attendance: 88 },
            { name: 'Joseph Young', year: 1, email: 'joseph.y@email.com', phone: '(555) 101-2026', status: 'PAID', balance: 0, attendance: 99 },
            { name: 'Sofia Hernandez', year: 1, email: 'sofia.h@email.com', phone: '(555) 101-2027', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'David King', year: 1, email: 'david.k@email.com', phone: '(555) 101-2028', status: 'PAID', balance: 0, attendance: 97 },
            { name: 'Avery Wright', year: 1, email: 'avery.w@email.com', phone: '(555) 101-2029', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Samuel Lopez', year: 1, email: 'samuel.l@email.com', phone: '(555) 101-2030', status: 'PAID', balance: 0, attendance: 95 },
            { name: 'Ella Hill', year: 1, email: 'ella.h@email.com', phone: '(555) 101-2031', status: 'PENDING', balance: 125, attendance: 91 },
            { name: 'Jackson Scott', year: 1, email: 'jackson.s@email.com', phone: '(555) 101-2032', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Scarlett Green', year: 1, email: 'scarlett.g@email.com', phone: '(555) 101-2033', status: 'PAID', balance: 0, attendance: 98 },
            { name: 'Sebastian Adams', year: 1, email: 'sebastian.a@email.com', phone: '(555) 101-2034', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Victoria Baker', year: 1, email: 'victoria.b@email.com', phone: '(555) 101-2035', status: 'PAID', balance: 0, attendance: 99 },

            // Year 2 Students (23 students) - $280 per semester
            { name: 'Grace Nelson', year: 2, email: 'grace.n@email.com', phone: '(555) 201-3001', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Henry Carter', year: 2, email: 'henry.c@email.com', phone: '(555) 201-3002', status: 'PENDING', balance: 140, attendance: 96 },
            { name: 'Chloe Mitchell', year: 2, email: 'chloe.m@email.com', phone: '(555) 201-3003', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Owen Perez', year: 2, email: 'owen.p@email.com', phone: '(555) 201-3004', status: 'PAID', balance: 0, attendance: 98 },
            { name: 'Lily Roberts', year: 2, email: 'lily.r@email.com', phone: '(555) 201-3005', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Jack Turner', year: 2, email: 'jack.t@email.com', phone: '(555) 201-3006', status: 'PENDING', balance: 280, attendance: 90 },
            { name: 'Zoey Phillips', year: 2, email: 'zoey.p@email.com', phone: '(555) 201-3007', status: 'PAID', balance: 0, attendance: 99 },
            { name: 'Luke Campbell', year: 2, email: 'luke.c@email.com', phone: '(555) 201-3008', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Nora Parker', year: 2, email: 'nora.p@email.com', phone: '(555) 201-3009', status: 'PAID', balance: 0, attendance: 97 },
            { name: 'Ryan Evans', year: 2, email: 'ryan.e@email.com', phone: '(555) 201-3010', status: 'PENDING', balance: 140, attendance: 94 },
            { name: 'Hannah Edwards', year: 2, email: 'hannah.e@email.com', phone: '(555) 201-3011', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Nathan Collins', year: 2, email: 'nathan.c@email.com', phone: '(555) 201-3012', status: 'PAID', balance: 0, attendance: 98 },
            { name: 'Layla Stewart', year: 2, email: 'layla.s@email.com', phone: '(555) 201-3013', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Isaac Sanchez', year: 2, email: 'isaac.s@email.com', phone: '(555) 201-3014', status: 'PAID', balance: 0, attendance: 99 },
            { name: 'Zoe Morris', year: 2, email: 'zoe.m@email.com', phone: '(555) 201-3015', status: 'PENDING', balance: 280, attendance: 87 },
            { name: 'Gabriel Rogers', year: 2, email: 'gabriel.r@email.com', phone: '(555) 201-3016', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Penelope Reed', year: 2, email: 'penelope.r@email.com', phone: '(555) 201-3017', status: 'PAID', balance: 0, attendance: 96 },
            { name: 'Julian Cook', year: 2, email: 'julian.c@email.com', phone: '(555) 201-3018', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Aria Morgan', year: 2, email: 'aria.m@email.com', phone: '(555) 201-3019', status: 'PAID', balance: 0, attendance: 98 },
            { name: 'Wyatt Bell', year: 2, email: 'wyatt.b@email.com', phone: '(555) 201-3020', status: 'PENDING', balance: 140, attendance: 92 },
            { name: 'Aurora Murphy', year: 2, email: 'aurora.m@email.com', phone: '(555) 201-3021', status: 'PAID', balance: 0, attendance: 100 },
            { name: 'Leo Bailey', year: 2, email: 'leo.b@email.com', phone: '(555) 201-3022', status: 'PAID', balance: 0, attendance: 99 },
            { name: 'Hazel Rivera', year: 2, email: 'hazel.r@email.com', phone: '(555) 201-3023', status: 'PAID', balance: 0, attendance: 100 }
        ];

        // Landing Page Functions
        function showLogin() {
            document.getElementById('loginModal').style.display = 'flex';
        }

        function showSignup() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('signupModal').style.display = 'flex';
        }

        function showStudentRegistration() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('studentRegistration').style.display = 'block';
            
            // Update the form with current ministry info if available
            const savedMinistry = localStorage.getItem('currentMinistry');
            if (savedMinistry) {
                const ministry = JSON.parse(savedMinistry);
                document.querySelector('.ministry-name').textContent = ministry.name;
                document.querySelector('.year-card:nth-child(1) .year-card-price').textContent = `${ministry.year1Tuition}`;
                document.querySelector('.year-card:nth-child(2) .year-card-price').textContent = `${ministry.year2Tuition}`;
                currentMinistry = ministry;
            }
        }

        function backToLanding() {
            document.getElementById('studentRegistration').style.display = 'none';
            document.getElementById('landingPage').style.display = 'flex';
            // Reset form
            document.querySelector('#studentRegistration form').reset();
            selectedYear = null;
            document.querySelectorAll('.year-card').forEach(card => card.classList.remove('selected'));
            document.getElementById('paymentSummary').style.display = 'none';
        }

        function closeModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('signupModal').style.display = 'none';
        }

        // Ministry Authentication
        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Simulate login - in production, this would validate against a database
            if (email && password) {
                // Check if there's a saved ministry account
                const savedMinistry = localStorage.getItem('ministryAccount');
                if (savedMinistry) {
                    const ministry = JSON.parse(savedMinistry);
                    if (ministry.email === email) {
                        currentMinistry = ministry;
                        localStorage.setItem('currentMinistry', JSON.stringify(ministry));
                        showDashboard(ministry);
                        closeModal();
                        return;
                    }
                }
                
                // Default demo account
                if (email === 'admin@schoolofpurpose.org') {
                    const defaultMinistry = {
                        name: 'School of Purpose',
                        year1Tuition: 250,
                        year2Tuition: 280,
                        email: email,
                        adminName: 'Admin User'
                    };
                    currentMinistry = defaultMinistry;
                    localStorage.setItem('currentMinistry', JSON.stringify(defaultMinistry));
                    showDashboard(defaultMinistry);
                    closeModal();
                } else {
                    alert('Invalid credentials. Try admin@schoolofpurpose.org with any password for demo.');
                }
            }
        }

        function handleSignup(event) {
            event.preventDefault();
            
            const ministry = {
                name: document.getElementById('ministryName').value,
                adminName: document.getElementById('firstName').value + ' ' + document.getElementById('lastName').value,
                email: document.getElementById('signupEmail').value,
                phone: document.getElementById('phone').value,
                year1Tuition: parseInt(document.getElementById('year1Tuition').value),
                year2Tuition: parseInt(document.getElementById('year2Tuition').value),
                createdAt: new Date().toISOString()
            };
            
            // Save ministry account
            localStorage.setItem('ministryAccount', JSON.stringify(ministry));
            localStorage.setItem('currentMinistry', JSON.stringify(ministry));
            currentMinistry = ministry;
            
            alert(`Ministry account created successfully for ${ministry.name}!`);
            showDashboard(ministry);
            closeModal();
        }

        // Student Registration Functions
        function selectYear(year, element) {
            selectedYear = year;
            document.querySelectorAll('.year-card').forEach(card => card.classList.remove('selected'));
            element.classList.add('selected');
            updatePaymentSummary();
        }

        function updatePaymentSummary() {
            if (!selectedYear) return;
            
            const paymentPlan = document.getElementById('paymentPlan').value;
            const tuition = selectedYear === 1 ? currentMinistry.year1Tuition : currentMinistry.year2Tuition;
            
            document.getElementById('paymentSummary').style.display = 'block';
            document.getElementById('selectedYear').textContent = `Year ${selectedYear}`;
            document.getElementById('baseTuition').textContent = `${tuition}`;
            
            let finalAmount = tuition;
            let showDiscount = false;
            
            if (paymentPlan === 'full') {
                // 5% discount for full payment
                const discount = tuition * 0.05;
                finalAmount = tuition - discount;
                showDiscount = true;
                document.getElementById('discount').textContent = `-${discount.toFixed(2)}`;
                document.getElementById('discountRow').style.display = 'flex';
            } else if (paymentPlan === 'semester') {
                document.getElementById('discountRow').style.display = 'none';
                document.getElementById('totalDue').textContent = `${(tuition/2).toFixed(2)} per semester`;
                return;
            } else if (paymentPlan === 'monthly') {
                document.getElementById('discountRow').style.display = 'none';
                document.getElementById('totalDue').textContent = `${(tuition/9).toFixed(2)} per month`;
                return;
            } else if (paymentPlan === 'scholarship') {
                document.getElementById('discountRow').style.display = 'none';
                document.getElementById('totalDue').textContent = 'Pending Review';
                return;
            } else {
                document.getElementById('discountRow').style.display = 'none';
            }
            
            document.getElementById('totalDue').textContent = `${finalAmount.toFixed(2)}`;
        }

        function handleStudentRegistration(event) {
            event.preventDefault();
            
            if (!selectedYear) {
                alert('Please select a program year (Year 1 or Year 2)');
                return;
            }
            
            const student = {
                firstName: document.getElementById('studentFirstName').value,
                lastName: document.getElementById('studentLastName').value,
                email: document.getElementById('studentEmail').value,
                phone: document.getElementById('studentPhone').value,
                dob: document.getElementById('studentDOB').value,
                parentName: document.getElementById('parentName').value,
                parentPhone: document.getElementById('parentPhone').value,
                year: selectedYear,
                tuition: selectedYear === 1 ? currentMinistry.year1Tuition : currentMinistry.year2Tuition,
                paymentPlan: document.getElementById('paymentPlan').value,
                referralSource: document.getElementById('referralSource').value,
                notes: document.getElementById('studentNotes').value,
                registrationDate: new Date().toISOString(),
                ministry: currentMinistry.name,
                status: 'pending'
            };
            
            // Save registration
            let registrations = JSON.parse(localStorage.getItem('studentRegistrations') || '[]');
            registrations.push(student);
            localStorage.setItem('studentRegistrations', JSON.stringify(registrations));
            
            // Show success message
            alert(`Thank you for registering, ${student.firstName}!\n\nYou have successfully registered for Year ${selectedYear} at ${currentMinistry.name}.\n\nYou will receive a confirmation email at ${student.email} with payment instructions.`);
            
            // Redirect to landing page
            backToLanding();
        }

        // Dashboard Functions
        function showDashboard(ministry) {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('dashboardMinistryName').textContent = ministry.name;
            
            // Set user avatar initials
            const initials = ministry.adminName ? 
                ministry.adminName.split(' ').map(n => n[0]).join('').toUpperCase() : 
                'AD';
            document.getElementById('userAvatar').textContent = initials;
            
            // Update dashboard stats with real data
            updateDashboardStats();
            
            // Load student table
            loadStudentTable();
            
            // Load student registrations
            loadRegistrations();
        }

        function updateDashboardStats() {
            const year1Students = allStudents.filter(s => s.year === 1);
            const year2Students = allStudents.filter(s => s.year === 2);
            const totalStudents = allStudents.length;
            
            // Calculate revenue
            const year1Revenue = year1Students.filter(s => s.status === 'PAID').length * 250;
            const year2Revenue = year2Students.filter(s => s.status === 'PAID').length * 280;
            const totalRevenue = year1Revenue + year2Revenue;
            
            // Calculate outstanding balance
            const totalOutstanding = allStudents.reduce((sum, s) => sum + s.balance, 0);
            const collectionRate = ((totalRevenue / (totalRevenue + totalOutstanding)) * 100).toFixed(0);
            
            // Update stat cards
            const statCards = document.querySelectorAll('.stat-card');
            if (statCards.length >= 4) {
                statCards[0].querySelector('.stat-value').textContent = totalStudents;
                statCards[0].querySelector('.stat-label').textContent = `${year1Students.length} Year 1, ${year2Students.length} Year 2`;
                
                statCards[1].querySelector('.stat-value').textContent = `$${totalRevenue.toLocaleString()}`;
                statCards[1].querySelector('.stat-label').textContent = `${collectionRate}% collected`;
                
                statCards[2].querySelector('.stat-value').textContent = year1Students.length;
                statCards[2].querySelector('.stat-label').textContent = '$250 per semester';
                
                statCards[3].querySelector('.stat-value').textContent = year2Students.length;
                statCards[3].querySelector('.stat-label').textContent = '$280 per semester';
            }
        }

        function loadRegistrations() {
            const registrations = JSON.parse(localStorage.getItem('studentRegistrations') || '[]');
            const ministryRegistrations = registrations.filter(r => r.ministry === currentMinistry.name);
            
            // Update stats
            const year1Count = ministryRegistrations.filter(r => r.year === 1).length;
            const year2Count = ministryRegistrations.filter(r => r.year === 2).length;
            
            console.log(`New Registrations - Year 1: ${year1Count}, Year 2: ${year2Count}`);
        }

        function switchTab(tabName, element) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            element.classList.add('active');

            // Hide all content sections
            const allContentSections = [
                'students-content',
                'materials-content',
                'announcements-content',
                'attendance-content',
                'registrations-content',
                'payments-content',
                'workflows-content',
                'financial-content',
                'communication-content',
                'reports-content',
                'settings-content'
            ];

            allContentSections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.style.display = 'none';
                }
            });

            // Show selected content
            const contentMap = {
                'students': 'students-content',
                'materials': 'materials-content',
                'announcements': 'announcements-content',
                'attendance': 'attendance-content',
                'registrations': 'registrations-content',
                'payments': 'payments-content',
                'workflows': 'workflows-content',
                'financial': 'financial-content',
                'communication': 'communication-content',
                'reports': 'reports-content',
                'settings': 'settings-content'
            };

            const contentId = contentMap[tabName];
            if (contentId) {
                const contentElement = document.getElementById(contentId);
                if (contentElement) {
                    contentElement.style.display = 'block';

                    // Load data for specific tabs
                    if (tabName === 'students') {
                        loadStudentTable();
                    } else if (tabName === 'materials') {
                        loadMaterialsList();
                    } else if (tabName === 'announcements') {
                        loadAnnouncementsList();
                    } else if (tabName === 'schedule') {
                        loadScheduleList();
                    } else if (tabName === 'registrations') {
                        showNewRegistrations();
                    }
                }
            }
        }

        // Load student table with all students
        function loadStudentTable() {
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';

            allStudents.forEach((student, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="checkbox-cell">
                        <input type="checkbox" class="student-checkbox" onchange="updateSelectedCount()">
                    </td>
                    <td><strong>${student.name}</strong></td>
                    <td>Year ${student.year}</td>
                    <td>${student.email}</td>
                    <td><span class="status-badge status-${student.status.toLowerCase()}">${student.status}</span></td>
                    <td>$${student.balance}</td>
                    <td>
                        <button class="action-btn btn-info" style="padding: 5px 10px;" onclick="viewStudentDetails(${index})">View</button>
                        <button class="action-btn btn-success" style="padding: 5px 10px;" onclick="generatePaymentLink(${index})">üí≥ Pay Link</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // View student details
        function viewStudentDetails(index) {
            const student = allStudents[index];
            alert(`Student Details:\n\nName: ${student.name}\nYear: ${student.year}\nEmail: ${student.email}\nPhone: ${student.phone}\nPayment Status: ${student.status}\nBalance: $${student.balance}\nAttendance: ${student.attendance}%`);
        }

        // Generate Sign-In Sheet
        function generateSignInSheet(type) {
            let students = [];
            let title = '';
            
            if (type === 'all') {
                students = allStudents;
                title = 'All Students Sign-In Sheet';
            } else if (type === 'year1') {
                students = allStudents.filter(s => s.year === 1);
                title = 'Year 1 Students Sign-In Sheet';
            } else if (type === 'year2') {
                students = allStudents.filter(s => s.year === 2);
                title = 'Year 2 Students Sign-In Sheet';
            }
            
            const today = new Date().toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            let html = `
                <div class="signin-sheet">
                    <div class="signin-header">
                        <div class="signin-title">${currentMinistry.name}</div>
                        <div class="signin-title">${title}</div>
                        <div class="signin-date">${today}</div>
                    </div>
                    
                    <table class="signin-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;">#</th>
                                <th>Student Name</th>
                                <th>Year</th>
                                <th class="signature-cell">Signature</th>
                                <th class="time-cell">Time In</th>
                                <th class="notes-cell">Notes</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            students.forEach((student, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong>${student.name}</strong></td>
                        <td>Year ${student.year}</td>
                        <td class="signature-cell"></td>
                        <td class="time-cell"></td>
                        <td class="notes-cell"></td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #333;">
                        <p><strong>Total Students:</strong> ${students.length}</p>
                        <p><strong>Instructor Signature:</strong> ___________________________________ <strong>Date:</strong> _______________</p>
                    </div>
                </div>
                
                <div class="print-button-container no-print">
                    <button class="action-btn btn-success" onclick="window.print()" style="padding: 12px 30px; font-size: 16px;">
                        üñ®Ô∏è Print Sign-In Sheet
                    </button>
                    <button class="action-btn btn-info" onclick="downloadSignInSheet()" style="padding: 12px 30px; font-size: 16px;">
                        üì• Download as PDF
                    </button>
                    <button class="action-btn btn-warning" onclick="document.getElementById('signInSheetContainer').innerHTML = '<p style=\\'color: #666; text-align: center; padding: 40px;\\'>Click one of the buttons above to generate a sign-in sheet</p>'" style="padding: 12px 30px; font-size: 16px;">
                        ‚úï Close
                    </button>
                </div>
            `;
            
            document.getElementById('signInSheetContainer').innerHTML = html;
        }

        function downloadSignInSheet() {
            alert('In a production environment, this would generate a PDF file for download.\n\nFor now, please use the Print button and select "Save as PDF" from your browser\'s print dialog.');
            window.print();
        }

        function showNewRegistrations() {
            const registrations = JSON.parse(localStorage.getItem('studentRegistrations') || '[]');
            const ministryRegistrations = registrations.filter(r => r.ministry === currentMinistry.name);
            
            let html = '<h2 style="margin-bottom: 20px;">New Student Registrations</h2>';
            
            if (ministryRegistrations.length === 0) {
                html += '<p>No new registrations yet.</p>';
            } else {
                html += '<table class="student-table"><thead><tr>';
                html += '<th>Name</th><th>Year</th><th>Email</th><th>Payment Plan</th><th>Registration Date</th><th>Actions</th>';
                html += '</tr></thead><tbody>';
                
                ministryRegistrations.forEach((reg, index) => {
                    const regDate = new Date(reg.registrationDate).toLocaleDateString();
                    html += `<tr>
                        <td><strong>${reg.firstName} ${reg.lastName}</strong></td>
                        <td>Year ${reg.year}</td>
                        <td>${reg.email}</td>
                        <td>${reg.paymentPlan}</td>
                        <td>${regDate}</td>
                        <td>
                            <button onclick="approveRegistration(${index})" style="padding: 5px 10px; background: var(--success); color: white; border: none; border-radius: 5px; margin-right: 5px;">Approve</button>
                            <button onclick="viewRegistration(${index})" style="padding: 5px 10px;">View</button>
                        </td>
                    </tr>`;
                });
                
                html += '</tbody></table>';
            }
            
            document.getElementById('registrations-content').innerHTML = html;
        }

        function approveRegistration(index) {
            const registrations = JSON.parse(localStorage.getItem('studentRegistrations') || '[]');
            const ministryRegistrations = registrations.filter(r => r.ministry === currentMinistry.name);
            
            if (ministryRegistrations[index]) {
                alert(`Registration approved for ${ministryRegistrations[index].firstName} ${ministryRegistrations[index].lastName}!`);
                showNewRegistrations();
            }
        }

        function viewRegistration(index) {
            const registrations = JSON.parse(localStorage.getItem('studentRegistrations') || '[]');
            const ministryRegistrations = registrations.filter(r => r.ministry === currentMinistry.name);
            
            if (ministryRegistrations[index]) {
                const reg = ministryRegistrations[index];
                let details = `Student Registration Details\n\n`;
                details += `Name: ${reg.firstName} ${reg.lastName}\n`;
                details += `Year: ${reg.year}\n`;
                details += `Email: ${reg.email}\n`;
                details += `Phone: ${reg.phone}\n`;
                details += `Tuition: ${reg.tuition}\n`;
                details += `Payment Plan: ${reg.paymentPlan}\n`;
                if (reg.parentName) details += `Parent/Guardian: ${reg.parentName}\n`;
                if (reg.notes) details += `Notes: ${reg.notes}\n`;
                
                alert(details);
            }
        }

        function showNotifications() {
            alert('Notifications:\n\n‚Ä¢ 3 new student registrations\n‚Ä¢ 5 payments received today\n‚Ä¢ 2 students with overdue payments');
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('landingPage').style.display = 'flex';
                localStorage.removeItem('currentMinistry');
            }
        }

        // ===== BULK OPERATIONS FUNCTIONS =====
        
        function showBulkActions() {
            const bar = document.getElementById('bulkActionsBar');
            bar.classList.toggle('active');
        }

        function toggleSelectAll(checkbox) {
            const checkboxes = document.querySelectorAll('.student-checkbox:not(#selectAll)');
            checkboxes.forEach(cb => cb.checked = checkbox.checked);
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('.student-checkbox:not(#selectAll)');
            const selectedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            document.getElementById('selectedCount').textContent = `${selectedCount} student${selectedCount !== 1 ? 's' : ''} selected`;
            
            // Show/hide bulk actions bar
            const bar = document.getElementById('bulkActionsBar');
            if (selectedCount > 0) {
                bar.classList.add('active');
            } else {
                bar.classList.remove('active');
            }
        }

        function clearSelection() {
            document.querySelectorAll('.student-checkbox').forEach(cb => cb.checked = false);
            updateSelectedCount();
        }

        function getSelectedStudents() {
            const checkboxes = document.querySelectorAll('.student-checkbox:not(#selectAll)');
            const selected = [];
            checkboxes.forEach((cb, index) => {
                if (cb.checked) {
                    selected.push(index);
                }
            });
            return selected;
        }

        // Bulk Attendance with QR Code
        function bulkMarkAttendance() {
            const selected = getSelectedStudents();
            if (selected.length === 0) {
                alert('Please select at least one student');
                return;
            }
            
            // Show QR code modal
            document.getElementById('qrAttendanceModal').classList.add('active');
            generateQRCode();
            startQRTimer();
        }

        function generateQRCode() {
            const qrDisplay = document.getElementById('qrCodeDisplay');
            qrDisplay.innerHTML = '';
            
            // Generate unique session ID
            const sessionId = 'ATT-' + Date.now();
            const qrData = `${window.location.origin}/checkin?session=${sessionId}`;
            
            // Create QR code
            new QRCode(qrDisplay, {
                text: qrData,
                width: 256,
                height: 256,
                colorDark: "#667eea",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            
            // Simulate check-ins
            setTimeout(() => {
                document.getElementById('checkinCount').textContent = '3';
                document.getElementById('checkinList').innerHTML = '‚úì Sarah Johnson<br>‚úì Michael Brown<br>‚úì Jennifer Davis';
            }, 2000);
        }

        function generateNewQR() {
            generateQRCode();
            document.getElementById('qrTimer').textContent = '15:00';
        }

        function startQRTimer() {
            let timeLeft = 900; // 15 minutes
            const timerElement = document.getElementById('qrTimer');
            
            const interval = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(interval);
                    timerElement.textContent = 'Expired';
                }
            }, 1000);
        }

        function downloadQR() {
            const canvas = document.querySelector('#qrCodeDisplay canvas');
            if (canvas) {
                const url = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.download = 'attendance-qr-code.png';
                link.href = url;
                link.click();
                alert('QR Code downloaded successfully!');
            }
        }

        function closeQRModal() {
            document.getElementById('qrAttendanceModal').classList.remove('active');
        }

        // Bulk Payment Recording
        function bulkRecordPayment() {
            const selected = getSelectedStudents();
            if (selected.length === 0) {
                alert('Please select at least one student');
                return;
            }
            
            document.getElementById('bulkPaymentModal').classList.add('active');
            document.getElementById('bulkPaymentStudentCount').textContent = selected.length;
            document.getElementById('bulkPaymentDate').valueAsDate = new Date();
            
            // Update total when amount changes
            document.getElementById('bulkPaymentAmount').oninput = function() {
                const amount = parseFloat(this.value) || 0;
                const total = amount * selected.length;
                document.getElementById('bulkPaymentTotal').textContent = total.toFixed(2);
            };
        }

        function processBulkPayment() {
            const amount = document.getElementById('bulkPaymentAmount').value;
            const method = document.getElementById('bulkPaymentMethod').value;
            const date = document.getElementById('bulkPaymentDate').value;
            
            if (!amount || amount <= 0) {
                alert('Please enter a valid payment amount');
                return;
            }
            
            showProgress('Recording payments...', () => {
                closeBulkPaymentModal();
                alert(`Successfully recorded ${getSelectedStudents().length} payments totaling $${document.getElementById('bulkPaymentTotal').textContent}`);
                clearSelection();
            });
        }

        function closeBulkPaymentModal() {
            document.getElementById('bulkPaymentModal').classList.remove('active');
        }

        // Bulk Messaging
        function bulkSendMessage() {
            const selected = getSelectedStudents();
            if (selected.length === 0) {
                alert('Please select at least one student');
                return;
            }
            
            document.getElementById('bulkMessageModal').classList.add('active');
            document.getElementById('bulkMessageRecipientCount').textContent = selected.length;
        }

        function sendBulkMessage() {
            const subject = document.getElementById('messageSubject').value;
            const body = document.getElementById('messageBody').value;
            const type = document.getElementById('messageType').value;
            
            if (!body.trim()) {
                alert('Please enter a message');
                return;
            }
            
            showProgress('Sending messages...', () => {
                closeBulkMessageModal();
                alert(`Successfully sent ${getSelectedStudents().length} ${type} messages!`);
                clearSelection();
            });
        }

        function closeBulkMessageModal() {
            document.getElementById('bulkMessageModal').classList.remove('active');
        }

        // Bulk Promotion
        function bulkPromote() {
            const selected = getSelectedStudents();
            if (selected.length === 0) {
                alert('Please select at least one student');
                return;
            }
            
            document.getElementById('bulkPromoteModal').classList.add('active');
            document.getElementById('bulkPromoteCount').textContent = selected.length;
            // Simulate year counts
            document.getElementById('promoteYear1Count').textContent = Math.floor(selected.length * 0.6);
            document.getElementById('promoteYear2Count').textContent = Math.ceil(selected.length * 0.4);
        }

        function processBulkPromotion() {
            const sendEmail = document.getElementById('sendPromotionEmail').checked;
            
            showProgress('Promoting students...', () => {
                closeBulkPromoteModal();
                alert(`Successfully promoted ${getSelectedStudents().length} students to the next year!`);
                clearSelection();
            });
        }

        function closeBulkPromoteModal() {
            document.getElementById('bulkPromoteModal').classList.remove('active');
        }

        // Bulk Invoice Generation
        function bulkGenerateInvoices() {
            const selected = getSelectedStudents();
            if (selected.length === 0) {
                alert('Please select at least one student');
                return;
            }
            
            document.getElementById('bulkInvoiceModal').classList.add('active');
            document.getElementById('bulkInvoiceCount').textContent = selected.length;
            
            // Set default due date to 30 days from now
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 30);
            document.getElementById('invoiceDueDate').valueAsDate = dueDate;
        }

        function generateBulkInvoices() {
            const period = document.getElementById('invoicePeriod').value;
            const dueDate = document.getElementById('invoiceDueDate').value;
            const emailInvoices = document.getElementById('emailInvoices').checked;
            
            if (!dueDate) {
                alert('Please select a due date');
                return;
            }
            
            showProgress('Generating invoices...', () => {
                closeBulkInvoiceModal();
                const message = `Successfully generated ${getSelectedStudents().length} invoices!`;
                alert(emailInvoices ? message + '\nInvoices have been emailed to students/parents.' : message);
                clearSelection();
            });
        }

        function closeBulkInvoiceModal() {
            document.getElementById('bulkInvoiceModal').classList.remove('active');
        }

        // Progress Modal
        function showProgress(message, callback) {
            document.getElementById('progressModal').classList.add('active');
            document.getElementById('progressText').textContent = message;
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('progressFill').textContent = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('progressModal').classList.remove('active');
                        document.getElementById('progressFill').style.width = '0%';
                        if (callback) callback();
                    }, 500);
                }
            }, 200);
        }

        // ===== FINANCIAL TOOLS FUNCTIONS =====
        
        function generatePaymentLink(studentIndex) {
            const student = allStudents[studentIndex];
            
            document.getElementById('paymentLinkModal').classList.add('active');
            document.getElementById('paymentLinkStudent').value = student.name;
            document.getElementById('paymentLinkAmount').value = student.balance || '';
            document.getElementById('generatedLinkSection').style.display = 'none';
        }

        function createPaymentLink() {
            const student = document.getElementById('paymentLinkStudent').value;
            const amount = document.getElementById('paymentLinkAmount').value;
            const description = document.getElementById('paymentLinkDescription').value;
            
            if (!amount || amount <= 0) {
                alert('Please enter a valid amount');
                return;
            }
            
            // Generate payment link
            const linkId = 'PAY-' + Date.now();
            const paymentLink = `${window.location.origin}/pay?id=${linkId}&amount=${amount}`;
            
            document.getElementById('generatedPaymentLink').value = paymentLink;
            document.getElementById('generatedLinkSection').style.display = 'block';
        }

        function copyPaymentLink() {
            const linkInput = document.getElementById('generatedPaymentLink');
            linkInput.select();
            document.execCommand('copy');
            alert('Payment link copied to clipboard!');
        }

        function emailPaymentLink() {
            alert('Payment link has been emailed to the student!');
        }

        function smsPaymentLink() {
            alert('Payment link has been sent via SMS!');
        }

        function closePaymentLinkModal() {
            document.getElementById('paymentLinkModal').classList.remove('active');
        }

        function showPaymentLinkGenerator() {
            alert('Select a student from the Students tab and click "Pay Link" to generate a payment link.');
        }

        function showFamilyAccounts() {
            document.getElementById('familyAccountsModal').classList.add('active');
        }

        function closeFamilyAccountsModal() {
            document.getElementById('familyAccountsModal').classList.remove('active');
        }

        function createNewFamily() {
            alert('Family account creation form would open here. This would allow linking multiple students under one parent/guardian account.');
        }

        function manageFamilyAccount(familyIndex) {
            alert('Family account management interface would open here, allowing you to:\n\n‚Ä¢ Add/remove students\n‚Ä¢ View combined balance\n‚Ä¢ Make family payments\n‚Ä¢ Update contact information');
        }

        function showScholarships() {
            document.getElementById('scholarshipsModal').classList.add('active');
        }

        function closeScholarshipsModal() {
            document.getElementById('scholarshipsModal').classList.remove('active');
        }

        function createScholarship() {
            alert('Scholarship creation form would open here.');
        }

        function filterScholarships(status) {
            alert(`Filtering scholarships by status: ${status}`);
        }

        function approveScholarship(index) {
            if (confirm('Approve this scholarship application?')) {
                alert('Scholarship approved! Student and parent have been notified.');
            }
        }

        function denyScholarship(index) {
            if (confirm('Deny this scholarship application?')) {
                alert('Scholarship application denied. Notification sent.');
            }
        }

        function viewScholarshipDetails(index) {
            alert('Detailed scholarship application view would open here.');
        }

        function showDonations() {
            document.getElementById('donationsModal').classList.add('active');
        }

        function closeDonationsModal() {
            document.getElementById('donationsModal').classList.remove('active');
        }

        function recordDonation() {
            alert('Donation recording form would open here, allowing you to:\n\n‚Ä¢ Record donor information\n‚Ä¢ Enter donation amount\n‚Ä¢ Specify purpose/fund\n‚Ä¢ Mark as tax-deductible\n‚Ä¢ Generate receipt');
        }

        // ===== WORKFLOW FUNCTIONS =====
        
        function toggleWorkflow(workflowType) {
            const workflows = {
                'welcome': 'Welcome Email Automation',
                'payment-reminders': 'Payment Reminder Sequences',
                'attendance': 'Attendance Alerts',
                'birthdays': 'Birthday & Anniversary Greetings',
                'certificates': 'Course Completion Certificates',
                'reenrollment': 'Re-enrollment Campaigns'
            };
            
            console.log(`Workflow "${workflows[workflowType]}" toggled`);
            alert(`Workflow "${workflows[workflowType]}" has been ${event.target.checked ? 'enabled' : 'disabled'}`);
        }

        function showWorkflowSettings() {
            alert('Workflow configuration panel would open here, allowing you to:\n\n‚Ä¢ Edit email templates\n‚Ä¢ Set timing schedules\n‚Ä¢ Configure triggers\n‚Ä¢ View workflow history\n‚Ä¢ Test workflows');
        }


        // ===== CSV EXPORT FUNCTION =====
        
        function exportToCSV() {
            const headers = ['Name', 'Year', 'Email', 'Phone', 'Payment Status', 'Balance', 'Attendance %'];
            const csvData = [headers];
            
            allStudents.forEach(student => {
                csvData.push([
                    student.name,
                    `Year ${student.year}`,
                    student.email,
                    student.phone,
                    student.status,
                    student.balance,
                    student.attendance
                ]);
            });
            
            const csvContent = csvData.map(row => row.join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `students_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            window.URL.revokeObjectURL(url);
            
            alert('‚úÖ Student data exported successfully!');
        }

        // ===== SEARCH AND FILTER FUNCTIONS =====
        
        let filteredStudents = [...allStudents];

        function filterStudents() {
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            const yearFilter = document.getElementById('yearFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            filteredStudents = allStudents.filter(student => {
                // Search filter
                const matchesSearch = searchTerm === '' || 
                    student.name.toLowerCase().includes(searchTerm) ||
                    student.email.toLowerCase().includes(searchTerm) ||
                    student.phone.includes(searchTerm);
                
                // Year filter
                const matchesYear = yearFilter === 'all' || student.year === parseInt(yearFilter);
                
                // Status filter
                const matchesStatus = statusFilter === 'all' || student.status === statusFilter;
                
                return matchesSearch && matchesYear && matchesStatus;
            });
            
            // Update results count
            document.getElementById('filterResults').textContent = 
                `Showing ${filteredStudents.length} of ${allStudents.length} students`;
            
            // Reload table with filtered students
            loadFilteredStudentTable();
        }

        function loadFilteredStudentTable() {
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';
            
            if (filteredStudents.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #999;">No students found matching your filters</td></tr>';
                return;
            }
            
            filteredStudents.forEach((student, index) => {
                const actualIndex = allStudents.indexOf(student);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="checkbox-cell">
                        <input type="checkbox" class="student-checkbox" onchange="updateSelectedCount()">
                    </td>
                    <td><strong>${student.name}</strong></td>
                    <td>Year ${student.year}</td>
                    <td>${student.email}</td>
                    <td><span class="status-badge status-${student.status.toLowerCase()}">${student.status}</span></td>
                    <td>$${student.balance}</td>
                    <td>
                        <button class="action-btn btn-info" style="padding: 5px 10px;" onclick="viewStudentDetails(${actualIndex})">View</button>
                        <button class="action-btn btn-success" style="padding: 5px 10px;" onclick="showPaymentProcessing(${actualIndex})">üí≥ Pay</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ===== PAYMENT PROCESSING FUNCTIONS =====
        
        let currentPaymentStudent = null;

        function showPaymentProcessing(studentIndex) {
            currentPaymentStudent = allStudents[studentIndex];
            
            document.getElementById('paymentProcessingModal').classList.add('active');
            document.getElementById('paymentStudentName').textContent = currentPaymentStudent.name;
            document.getElementById('paymentStudentYear').textContent = `Year ${currentPaymentStudent.year}`;
            document.getElementById('paymentAmountDue').textContent = currentPaymentStudent.balance;
            document.getElementById('paymentAmount').value = currentPaymentStudent.balance;
            
            // Set today's date for manual payment
            document.getElementById('manualPaymentDate').valueAsDate = new Date();
            
            // Reset payment method selection
            document.getElementById('stripePayment').style.display = 'none';
            document.getElementById('squarePayment').style.display = 'none';
            document.getElementById('manualPayment').style.display = 'none';
        }

        function closePaymentProcessingModal() {
            document.getElementById('paymentProcessingModal').classList.remove('active');
            currentPaymentStudent = null;
        }

        function selectPaymentMethod(method) {
            // Hide all payment forms
            document.getElementById('stripePayment').style.display = 'none';
            document.getElementById('squarePayment').style.display = 'none';
            document.getElementById('manualPayment').style.display = 'none';
            
            // Reset button styles
            document.getElementById('stripeBtn').style.background = '';
            document.getElementById('squareBtn').style.background = '';
            document.getElementById('manualBtn').style.background = '';
            
            // Show selected payment form and highlight button
            if (method === 'stripe') {
                document.getElementById('stripePayment').style.display = 'block';
                document.getElementById('stripeBtn').style.background = 'var(--primary)';
                document.getElementById('stripeBtn').style.color = 'white';
            } else if (method === 'square') {
                document.getElementById('squarePayment').style.display = 'block';
                document.getElementById('squareBtn').style.background = 'var(--primary)';
                document.getElementById('squareBtn').style.color = 'white';
            } else if (method === 'manual') {
                document.getElementById('manualPayment').style.display = 'block';
                document.getElementById('manualBtn').style.background = 'var(--primary)';
                document.getElementById('manualBtn').style.color = 'white';
            }
        }

        function processStripePayment() {
            const amount = document.getElementById('paymentAmount').value;
            
            if (!amount || amount <= 0) {
                alert('Please enter a valid payment amount');
                return;
            }
            
            // In production, this would call Stripe API
            showProgress('Processing Stripe payment...', () => {
                // Update student balance
                currentPaymentStudent.balance = Math.max(0, currentPaymentStudent.balance - parseFloat(amount));
                currentPaymentStudent.status = currentPaymentStudent.balance === 0 ? 'PAID' : 'PENDING';
                
                closePaymentProcessingModal();
                alert(`‚úÖ Payment of $${amount} processed successfully via Stripe!\n\nReceipt sent to ${currentPaymentStudent.email}`);
                loadStudentTable();
                updateDashboardStats();
            });
        }

        function processSquarePayment() {
            const amount = document.getElementById('paymentAmount').value;
            
            if (!amount || amount <= 0) {
                alert('Please enter a valid payment amount');
                return;
            }
            
            // In production, this would call Square API
            showProgress('Processing Square payment...', () => {
                // Update student balance
                currentPaymentStudent.balance = Math.max(0, currentPaymentStudent.balance - parseFloat(amount));
                currentPaymentStudent.status = currentPaymentStudent.balance === 0 ? 'PAID' : 'PENDING';
                
                closePaymentProcessingModal();
                alert(`‚úÖ Payment of $${amount} processed successfully via Square!\n\nReceipt sent to ${currentPaymentStudent.email}`);
                loadStudentTable();
                updateDashboardStats();
            });
        }

        function processManualPayment() {
            const amount = document.getElementById('paymentAmount').value;
            const paymentType = document.getElementById('manualPaymentType').value;
            const reference = document.getElementById('referenceNumber').value;
            const date = document.getElementById('manualPaymentDate').value;
            const notes = document.getElementById('manualPaymentNotes').value;
            
            if (!amount || amount <= 0) {
                alert('Please enter a valid payment amount');
                return;
            }
            
            if (!date) {
                alert('Please select a payment date');
                return;
            }
            
            // Update student balance
            currentPaymentStudent.balance = Math.max(0, currentPaymentStudent.balance - parseFloat(amount));
            currentPaymentStudent.status = currentPaymentStudent.balance === 0 ? 'PAID' : 'PENDING';
            
            closePaymentProcessingModal();
            
            let message = `‚úÖ Payment of $${amount} recorded successfully!\n\n`;
            message += `Payment Type: ${paymentType.charAt(0).toUpperCase() + paymentType.slice(1)}\n`;
            message += `Date: ${new Date(date).toLocaleDateString()}\n`;
            if (reference) message += `Reference: ${reference}\n`;
            if (notes) message += `Notes: ${notes}`;
            
            alert(message);
            loadStudentTable();
            updateDashboardStats();
        }

        // ===== COMMUNICATION CENTER FUNCTIONS =====
        
        function showCommunicationCenter() {
            document.getElementById('communicationModal').classList.add('active');
            
            // Setup schedule checkbox listener
            document.getElementById('scheduleMessage').onchange = function() {
                document.getElementById('scheduleOptions').style.display = this.checked ? 'block' : 'none';
            };
        }

        function closeCommunicationModal() {
            document.getElementById('communicationModal').classList.remove('active');
        }

        function setupEmailIntegration() {
            alert('Email Integration Setup\n\nIn production, this would allow you to connect:\n\n‚Ä¢ SendGrid\n‚Ä¢ Mailgun\n‚Ä¢ Amazon SES\n‚Ä¢ SMTP Server\n\nYou would enter your API keys and configure email templates.');
        }

        function setupSMSIntegration() {
            alert('SMS Integration Setup\n\nIn production, this would allow you to connect:\n\n‚Ä¢ Twilio\n‚Ä¢ Plivo\n‚Ä¢ MessageBird\n\nYou would enter your API credentials and configure SMS templates.');
        }

        function sendCommunication() {
            const recipients = document.getElementById('messageRecipients').value;
            const messageType = document.getElementById('commMessageType').value;
            const subject = document.getElementById('commSubject').value;
            const message = document.getElementById('commMessage').value;
            const scheduled = document.getElementById('scheduleMessage').checked;
            
            if (!message.trim()) {
                alert('Please enter a message');
                return;
            }
            
            if (messageType.includes('email') && !subject.trim()) {
                alert('Please enter an email subject');
                return;
            }
            
            let recipientCount = 0;
            switch(recipients) {
                case 'all':
                    recipientCount = allStudents.length;
                    break;
                case 'year1':
                    recipientCount = allStudents.filter(s => s.year === 1).length;
                    break;
                case 'year2':
                    recipientCount = allStudents.filter(s => s.year === 2).length;
                    break;
                case 'pending':
                    recipientCount = allStudents.filter(s => s.status === 'PENDING').length;
                    break;
                case 'selected':
                    recipientCount = getSelectedStudents().length;
                    break;
            }
            
            if (scheduled) {
                const scheduleDate = document.getElementById('scheduleDate').value;
                const scheduleTime = document.getElementById('scheduleTime').value;
                
                if (!scheduleDate || !scheduleTime) {
                    alert('Please select both date and time for scheduled message');
                    return;
                }
                
                alert(`‚úÖ Message scheduled successfully!\n\nRecipients: ${recipientCount} students\nType: ${messageType}\nScheduled for: ${new Date(scheduleDate + ' ' + scheduleTime).toLocaleString()}`);
            } else {
                showProgress('Sending messages...', () => {
                    closeCommunicationModal();
                    alert(`‚úÖ Messages sent successfully!\n\nRecipients: ${recipientCount} students\nType: ${messageType}`);
                });
            }
        }

        // ===== UPLOAD MATERIALS FUNCTIONS =====
        
        let selectedFile = null;

        function showUploadMaterials() {
            document.getElementById('uploadMaterialsModal').classList.add('active');
        }

        function closeUploadMaterialsModal() {
            document.getElementById('uploadMaterialsModal').classList.remove('active');
            // Reset form
            document.getElementById('materialTitle').value = '';
            document.getElementById('materialCategory').value = '';
            document.getElementById('materialClass').value = 'all';
            document.getElementById('materialDescription').value = '';
            document.getElementById('materialFile').value = '';
            document.getElementById('filePreview').style.display = 'none';
            selectedFile = null;
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            
            if (!file) {
                document.getElementById('filePreview').style.display = 'none';
                selectedFile = null;
                return;
            }
            
            // Check file size (10MB limit)
            const maxSize = 10 * 1024 * 1024; // 10MB in bytes
            if (file.size > maxSize) {
                alert('File size exceeds 10MB limit. Please choose a smaller file.');
                event.target.value = '';
                document.getElementById('filePreview').style.display = 'none';
                selectedFile = null;
                return;
            }
            
            // Check file type
            const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            if (!allowedTypes.includes(file.type)) {
                alert('Invalid file type. Please upload PDF, DOC, or DOCX files only.');
                event.target.value = '';
                document.getElementById('filePreview').style.display = 'none';
                selectedFile = null;
                return;
            }
            
            // Show file preview
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = `Size: ${(file.size / 1024).toFixed(2)} KB`;
            document.getElementById('filePreview').style.display = 'block';
            
            // Read file as base64
            const reader = new FileReader();
            reader.onload = function(e) {
                selectedFile = {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    data: e.target.result
                };
            };
            reader.readAsDataURL(file);
        }

        function uploadMaterial() {
            const title = document.getElementById('materialTitle').value.trim();
            const category = document.getElementById('materialCategory').value;
            const classFor = document.getElementById('materialClass').value;
            const description = document.getElementById('materialDescription').value.trim();
            const notify = document.getElementById('notifyStudents').checked;
            
            // Validation
            if (!title) {
                alert('Please enter a material title');
                return;
            }
            
            if (!category) {
                alert('Please select a category');
                return;
            }
            
            if (!selectedFile) {
                alert('Please select a file to upload');
                return;
            }
            
            // Create material object
            const material = {
                id: Date.now(),
                title: title,
                category: category,
                classFor: classFor,
                description: description,
                fileName: selectedFile.name,
                fileSize: selectedFile.size,
                fileType: selectedFile.type,
                fileData: selectedFile.data,
                uploadedBy: currentMinistry.adminName || 'Admin',
                uploadDate: new Date().toISOString(),
                downloads: 0,
                visible: true  // Default to visible
            };
            
            // Save to localStorage
            let materials = JSON.parse(localStorage.getItem('studyMaterials') || '[]');
            materials.unshift(material); // Add to beginning
            localStorage.setItem('studyMaterials', JSON.stringify(materials));
            
            // Close modal and refresh list
            closeUploadMaterialsModal();
            loadMaterialsList();
            
            // Show success message
            let message = `‚úÖ Material uploaded successfully!\n\n"${title}" is now available in the Student Portal.`;
            if (notify) {
                message += '\n\nüìß Notification sent to all students.';
            }
            alert(message);
        }

        function loadMaterialsList() {
            const materials = JSON.parse(localStorage.getItem('studyMaterials') || '[]');
            const materialsListDiv = document.getElementById('materialsList');
            
            if (!materialsListDiv) return;
            
            if (materials.length === 0) {
                materialsListDiv.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No materials uploaded yet.</p>';
                return;
            }
            
            let html = '';
            materials.forEach((material, index) => {
                const uploadDate = new Date(material.uploadDate).toLocaleDateString();
                const fileIcon = material.fileType && material.fileType.includes('pdf') ? 'üìï' : 'üìÑ';
                const categoryLabel = material.category ? material.category.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase()) : 'Material';
                
                // Default to visible if not set
                const isVisible = material.visible !== false;
                const visibilityClass = isVisible ? 'visible' : 'hidden';
                const visibilityIcon = isVisible ? 'üëÅÔ∏è' : 'üö´';
                const visibilityText = isVisible ? 'Visible' : 'Hidden';
                
                html += `
                    <div class="workflow-card" style="margin-bottom: 15px; ${!isVisible ? 'opacity: 0.6;' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                    <span style="font-size: 24px;">${fileIcon}</span>
                                    <strong style="font-size: 18px; color: var(--primary);">${material.title}</strong>
                                    ${!isVisible ? '<span style="background: #f5f5f5; color: #999; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;">HIDDEN FROM STUDENTS</span>' : ''}
                                </div>
                                <div style="margin-bottom: 8px;">
                                    <span class="badge" style="background: var(--light); color: var(--primary); padding: 4px 12px; border-radius: 20px; font-size: 12px; margin-right: 8px;">${categoryLabel}</span>
                                    ${material.classFor && material.classFor !== 'all' ? `<span class="badge" style="background: var(--light); color: var(--primary); padding: 4px 12px; border-radius: 20px; font-size: 12px;">${material.classFor.charAt(0).toUpperCase() + material.classFor.slice(1)} Class</span>` : ''}
                                </div>
                                ${material.description ? `<p style="color: #666; font-size: 14px; margin-bottom: 8px;">${material.description}</p>` : ''}
                                <p style="font-size: 13px; color: #999;">
                                    üìÖ ${uploadDate} ‚Ä¢ üì¶ ${(material.fileSize / 1024).toFixed(2)} KB ‚Ä¢ ‚¨áÔ∏è ${material.downloads || 0} downloads
                                </p>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <button class="visibility-toggle ${visibilityClass}" onclick="toggleMaterialVisibility(${index})" title="Click to ${isVisible ? 'hide' : 'show'}">
                                    ${visibilityIcon} ${visibilityText}
                                </button>
                                <button class="action-btn btn-danger" onclick="deleteMaterial(${index})" style="padding: 8px 16px;">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            materialsListDiv.innerHTML = html;
        }

        function deleteMaterial(index) {
            if (!confirm('Are you sure you want to delete this material? This action cannot be undone.')) {
                return;
            }
            
            let materials = JSON.parse(localStorage.getItem('studyMaterials') || '[]');
            const deletedMaterial = materials[index];
            materials.splice(index, 1);
            localStorage.setItem('studyMaterials', JSON.stringify(materials));
            
            loadMaterialsList();
            alert(`‚úÖ "${deletedMaterial.title}" has been deleted.`);
        }

        // ===== ANNOUNCEMENTS FUNCTIONS =====
        
        function showAddAnnouncement() {
            document.getElementById('addAnnouncementModal').classList.add('active');
        }

        function closeAddAnnouncementModal() {
            document.getElementById('addAnnouncementModal').classList.remove('active');
            // Reset form
            document.getElementById('announcementTitle').value = '';
            document.getElementById('announcementMessage').value = '';
            document.getElementById('announcementPriority').value = 'normal';
        }

        function postAnnouncement() {
            const title = document.getElementById('announcementTitle').value.trim();
            const message = document.getElementById('announcementMessage').value.trim();
            const priority = document.getElementById('announcementPriority').value;
            const notify = document.getElementById('notifyStudentsAnnouncement').checked;
            
            // Validation
            if (!title) {
                alert('Please enter an announcement title');
                return;
            }
            
            if (!message) {
                alert('Please enter an announcement message');
                return;
            }
            
            // Create announcement object
            const announcement = {
                id: Date.now(),
                title: title,
                message: message,
                priority: priority,
                postedBy: currentMinistry.adminName || 'Admin',
                date: new Date().toISOString(),
                visible: true  // Default to visible
            };
            
            // Save to localStorage
            let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            announcements.unshift(announcement); // Add to beginning
            localStorage.setItem('announcements', JSON.stringify(announcements));
            
            // Close modal and refresh list
            closeAddAnnouncementModal();
            loadAnnouncementsList();
            
            // Show success message
            let successMessage = `‚úÖ Announcement posted successfully!\n\n"${title}" is now visible in the Student Portal.`;
            if (notify) {
                successMessage += '\n\nüìß Notification sent to all students.';
            }
            alert(successMessage);
        }

        function loadAnnouncementsList() {
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            const announcementsListDiv = document.getElementById('announcementsList');
            
            if (!announcementsListDiv) return;
            
            if (announcements.length === 0) {
                announcementsListDiv.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No announcements yet.</p>';
                return;
            }
            
            let html = '';
            announcements.forEach((announcement, index) => {
                const date = new Date(announcement.date).toLocaleDateString();
                const priorityColor = announcement.priority === 'urgent' ? '#f44336' : 
                                     announcement.priority === 'important' ? '#ff9800' : '#666';
                
                // Default to visible if not set
                const isVisible = announcement.visible !== false;
                const visibilityClass = isVisible ? 'visible' : 'hidden';
                const visibilityIcon = isVisible ? 'üëÅÔ∏è' : 'üö´';
                const visibilityText = isVisible ? 'Visible' : 'Hidden';
                
                html += `
                    <div class="workflow-card" style="margin-bottom: 15px; border-left: 4px solid ${priorityColor}; ${!isVisible ? 'opacity: 0.6;' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                    <strong style="font-size: 18px; color: var(--primary);">${announcement.title}</strong>
                                    ${announcement.priority !== 'normal' ? `<span class="badge" style="background: ${priorityColor}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 11px; text-transform: uppercase;">${announcement.priority}</span>` : ''}
                                    ${!isVisible ? '<span style="background: #f5f5f5; color: #999; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;">HIDDEN FROM STUDENTS</span>' : ''}
                                </div>
                                <p style="color: #666; font-size: 14px; margin-bottom: 8px;">${announcement.message}</p>
                                <p style="font-size: 13px; color: #999;">
                                    üìÖ Posted on ${date} by ${announcement.postedBy}
                                </p>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <button class="visibility-toggle ${visibilityClass}" onclick="toggleAnnouncementVisibility(${index})" title="Click to ${isVisible ? 'hide' : 'show'}">
                                    ${visibilityIcon} ${visibilityText}
                                </button>
                                <button class="action-btn btn-danger" onclick="deleteAnnouncement(${index})" style="padding: 8px 16px;">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            announcementsListDiv.innerHTML = html;
        }

        function deleteAnnouncement(index) {
            if (!confirm('Are you sure you want to delete this announcement?')) {
                return;
            }
            
            let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            const deletedAnnouncement = announcements[index];
            announcements.splice(index, 1);
            localStorage.setItem('announcements', JSON.stringify(announcements));
            
            loadAnnouncementsList();
            alert(`‚úÖ "${deletedAnnouncement.title}" has been deleted.`);
        }

        // ===== REVENUE PRIVACY FUNCTIONS =====
        
        let revenueVisible = false;

        function toggleRevenue() {
            revenueVisible = !revenueVisible;
            const revenueCards = document.querySelectorAll('.revenue-card');
            const toggleBtn = document.getElementById('revenueToggleBtn');
            
            if (revenueVisible) {
                revenueCards.forEach(card => card.classList.remove('revenue-hidden'));
                toggleBtn.innerHTML = 'üîì Hide Revenue';
                toggleBtn.style.background = 'var(--danger)';
            } else {
                revenueCards.forEach(card => card.classList.add('revenue-hidden'));
                toggleBtn.innerHTML = 'üîí Show Revenue';
                toggleBtn.style.background = 'var(--primary)';
            }
        }

        // ===== CLASS SCHEDULE MANAGEMENT FUNCTIONS =====
        
        function showAddClass() {
            document.getElementById('addClassModal').classList.add('active');
            document.getElementById('classModalTitle').textContent = 'üìÖ Add Class to Schedule';
            document.getElementById('editingClassIndex').value = '-1';
            
            // Reset form
            document.getElementById('classDay').value = '';
            document.getElementById('classTitle').value = '';
            document.getElementById('classTime').value = '';
            document.getElementById('classTopic').value = '';
            document.getElementById('classDescription').value = '';
        }

        function closeAddClassModal() {
            document.getElementById('addClassModal').classList.remove('active');
        }

        function saveClass() {
            const day = document.getElementById('classDay').value;
            const title = document.getElementById('classTitle').value.trim();
            const time = document.getElementById('classTime').value.trim();
            const topic = document.getElementById('classTopic').value.trim();
            const description = document.getElementById('classDescription').value.trim();
            const editingIndex = parseInt(document.getElementById('editingClassIndex').value);
            
            // Validation
            if (!day) {
                alert('Please select a day of the week');
                return;
            }
            
            if (!title) {
                alert('Please enter a class title');
                return;
            }
            
            if (!time) {
                alert('Please enter the class time');
                return;
            }
            
            if (!topic) {
                alert('Please enter the class topic');
                return;
            }
            
            // Create class object
            const classItem = {
                day: day,
                title: title,
                time: time,
                topic: topic,
                description: description || 'Class details will be provided'
            };
            
            // Get current schedule
            let schedule = JSON.parse(localStorage.getItem('classSchedule') || '[]');
            
            if (editingIndex >= 0) {
                // Update existing class
                schedule[editingIndex] = classItem;
                alert(`‚úÖ Class updated successfully!\n\n"${day} - ${title}" has been updated in the schedule.`);
            } else {
                // Add new class
                schedule.push(classItem);
                alert(`‚úÖ Class added successfully!\n\n"${day} - ${title}" has been added to the schedule.`);
            }
            
            // Save to localStorage
            localStorage.setItem('classSchedule', JSON.stringify(schedule));
            
            // Close modal and refresh list
            closeAddClassModal();
            loadScheduleList();
        }

        function loadScheduleList() {
            const schedule = JSON.parse(localStorage.getItem('classSchedule') || '[]');
            const scheduleListDiv = document.getElementById('scheduleList');
            
            if (!scheduleListDiv) return;
            
            if (schedule.length === 0) {
                scheduleListDiv.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No classes scheduled yet. Click "Add Class" to create your schedule.</p>';
                return;
            }
            
            // Sort by day of week
            const dayOrder = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            schedule.sort((a, b) => dayOrder.indexOf(a.day) - dayOrder.indexOf(b.day));
            
            let html = '';
            schedule.forEach((classItem, index) => {
                html += `
                    <div class="workflow-card" style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                    <strong style="font-size: 18px; color: var(--primary);">${classItem.day} - ${classItem.title}</strong>
                                    <span class="badge" style="background: #e3f2fd; color: #1976d2; padding: 4px 12px; border-radius: 20px; font-size: 12px;">${classItem.time}</span>
                                </div>
                                <p style="margin-bottom: 8px; color: var(--dark); font-weight: 600;">Topic: ${classItem.topic}</p>
                                <p style="color: #666; font-size: 14px;">${classItem.description}</p>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <button class="action-btn btn-info" onclick="editClass(${index})" style="padding: 8px 16px;">
                                    ‚úèÔ∏è Edit
                                </button>
                                <button class="action-btn btn-danger" onclick="deleteClass(${index})" style="padding: 8px 16px;">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            scheduleListDiv.innerHTML = html;
        }

        function editClass(index) {
            const schedule = JSON.parse(localStorage.getItem('classSchedule') || '[]');
            
            if (schedule[index]) {
                const classItem = schedule[index];
                
                // Open modal with existing data
                document.getElementById('addClassModal').classList.add('active');
                document.getElementById('classModalTitle').textContent = '‚úèÔ∏è Edit Class';
                document.getElementById('editingClassIndex').value = index;
                
                // Fill form with existing data
                document.getElementById('classDay').value = classItem.day;
                document.getElementById('classTitle').value = classItem.title;
                document.getElementById('classTime').value = classItem.time;
                document.getElementById('classTopic').value = classItem.topic;
                document.getElementById('classDescription').value = classItem.description;
            }
        }

        function deleteClass(index) {
            const schedule = JSON.parse(localStorage.getItem('classSchedule') || '[]');
            
            if (schedule[index]) {
                const classItem = schedule[index];
                
                if (confirm(`Are you sure you want to delete this class?\n\n${classItem.day} - ${classItem.title}\n\nThis will remove it from the student portal.`)) {
                    schedule.splice(index, 1);
                    localStorage.setItem('classSchedule', JSON.stringify(schedule));
                    
                    alert(`‚úÖ Class deleted successfully!\n\n"${classItem.day} - ${classItem.title}" has been removed from the schedule.`);
                    loadScheduleList();
                }
            }
        }

        // ===== VISIBILITY CONTROL FUNCTIONS =====
        
        function toggleMaterialVisibility(index) {
            let materials = JSON.parse(localStorage.getItem('studyMaterials') || '[]');
            
            if (materials[index]) {
                materials[index].visible = !materials[index].visible;
                localStorage.setItem('studyMaterials', JSON.stringify(materials));
                loadMaterialsList();
                
                const status = materials[index].visible ? 'visible' : 'hidden';
                console.log(`Material "${materials[index].title}" is now ${status}`);
            }
        }

        function toggleAnnouncementVisibility(index) {
            let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            
            if (announcements[index]) {
                announcements[index].visible = !announcements[index].visible;
                localStorage.setItem('announcements', JSON.stringify(announcements));
                loadAnnouncementsList();
                
                const status = announcements[index].visible ? 'visible' : 'hidden';
                console.log(`Announcement "${announcements[index].title}" is now ${status}`);
            }
        }

        function bulkToggleVisibility(type, visible) {
            if (type === 'materials') {
                let materials = JSON.parse(localStorage.getItem('studyMaterials') || '[]');
                materials.forEach(m => m.visible = visible);
                localStorage.setItem('studyMaterials', JSON.stringify(materials));
                loadMaterialsList();
                alert(`All materials are now ${visible ? 'visible' : 'hidden'} to students`);
            } else if (type === 'announcements') {
                let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
                announcements.forEach(a => a.visible = visible);
                localStorage.setItem('announcements', JSON.stringify(announcements));
                loadAnnouncementsList();
                alert(`All announcements are now ${visible ? 'visible' : 'hidden'} to students`);
            }
        }

        // Initialize - Check if user is already logged in
        window.onload = function() {
            const savedMinistry = localStorage.getItem('currentMinistry');
            if (savedMinistry) {
                const ministry = JSON.parse(savedMinistry);
                currentMinistry = ministry;
                // Uncomment to auto-login if already signed in
                // showDashboard(ministry);
            }
            
            // Set today's date for payment date field
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('bulkPaymentDate')) {
                document.getElementById('bulkPaymentDate').value = today;
            }
            
            // Log that script loaded successfully
            console.log('‚úÖ School of Purpose - All scripts loaded successfully!');
            console.log('üìù Demo Login: admin@schoolofpurpose.org + any password');
        }
    </script>
    
    <!-- Load external upload functions after main script -->
    <script src="student-portal-upload.js"></script>
</body>
</html>
